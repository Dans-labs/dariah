<!doctype html><html lang=en class=no-js> <head><link href=https://fonts.gstatic.com rel=preconnect crossorigin><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="The technical documentation of the DARIAH Contribution Tool. Design, specs, rationales, patterns, diagrams.
"><link href=https://dans-labs.github.io/dariah/Concepts/Model/ rel=canonical><meta name=author content="Dirk Roorda"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../icons/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-dans-4.4.1"><title>Model - Tech Doc DARIAH contribution tool</title><link rel=stylesheet href=../../assets/stylesheets/application.27a306a7.css><script src=../../assets/javascripts/modernizr.74668098.js></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|Glegoo:300,400,400i,700|Ubuntu+Mono&display=swap"><style>.body-type,body,input{font-family:"Open Sans",sans-serif}.head-type,h1,h2,h3,h4,h5{font-family:"Glegoo",serif}.code-type,code,kbd,pre{font-family:"Ubuntu Mono",monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#model tabindex=1 class=md-skip> Skip to content </a> <header class="md-header md-dev" data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://www.dariah.eu title=DARIAH class="md-header-nav__button md-logo"> <img src=../../images/dariah.png height=50> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://dans-labs.github.io/dariah/ title="Tech Doc DARIAH contribution tool" class="md-header-nav__button md-logo"> <img src=../../images/inkind_logo.png height=50> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title head-type" data-md-component=title> <span class=md-header-nav__topic> Tech Doc DARIAH contribution tool <span class="md-dev-inline head-type"> still in beta </span> </span> <span class=md-header-nav__topic> Model <span class="md-dev-inline head-type"> still in beta </span> </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/dans-labs/dariah/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Dans-labs/dariah </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. title=Home class="md-tabs__link head-type"> Home </a> </li> <li class=md-tabs__item> <a href=../../About/Codebase/ title=About class="md-tabs__link head-type"> About </a> </li> <li class=md-tabs__item> <a href=../../Functionality/Business/ title=Functionality class="md-tabs__link head-type"> Functionality </a> </li> <li class=md-tabs__item> <a href=../../Legacy/Content/ title=Legacy class="md-tabs__link head-type"> Legacy </a> </li> <li class=md-tabs__item> <a href=../Architecture/ title=Concepts class="md-tabs__link md-tabs__link--active head-type"> Concepts </a> </li> <li class=md-tabs__item> <a href=../../Server/Authentication/ title=Server class="md-tabs__link head-type"> Server </a> </li> <li class=md-tabs__item> <a href=../../Client/Components/ title=Client class="md-tabs__link head-type"> Client </a> </li> <li class=md-tabs__item> <a href=../../Technology/Tech/ title=Technology class="md-tabs__link head-type"> Technology </a> </li> <li class=md-tabs__item> <a href=../../Integration/API/ title=Integration class="md-tabs__link head-type"> Integration </a> </li> <li class=md-tabs__item> <a href=../../Maintenance/Deploy/ title=Maintenance class="md-tabs__link head-type"> Maintenance </a> </li> </ul> </div> </nav> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title head-type md-nav__title--site" for=__drawer> <a href=https://dans-labs.github.io/dariah/ title="Tech Doc DARIAH contribution tool" class="md-nav__button md-logo"> <img src=../../images/inkind_logo.png width=48 height=48> </a> Tech Doc DARIAH contribution tool </label> <div class=md-nav__source> <a href=https://github.com/dans-labs/dariah/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Dans-labs/dariah </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class="md-nav__link head-type"> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class="md-nav__link head-type" for=nav-2> About </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-2> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../About/Codebase/ title=Codebase class="md-nav__link head-type"> Codebase </a> </li> <li class=md-nav__item> <a href=../../About/Stats/ title=Stats class="md-nav__link head-type"> Stats </a> </li> <li class=md-nav__item> <a href=../../About/News/ title=News class="md-nav__link head-type"> News </a> </li> <li class=md-nav__item> <a href=../../About/Lessons/ title=Lessons class="md-nav__link head-type"> Lessons </a> </li> <li class=md-nav__item> <a href=../../About/Diagrams/ title=Diagrams class="md-nav__link head-type"> Diagrams </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class="md-nav__link head-type" for=nav-3> Functionality </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-3> Functionality </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Functionality/Business/ title=Business class="md-nav__link head-type"> Business </a> </li> <li class=md-nav__item> <a href=../../Functionality/Tables/ title=Tables class="md-nav__link head-type"> Tables </a> </li> <li class=md-nav__item> <a href=../../Functionality/Workflow/ title=Workflow class="md-nav__link head-type"> Workflow </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class="md-nav__link head-type" for=nav-4> Legacy </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-4> Legacy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Legacy/Content/ title=Content class="md-nav__link head-type"> Content </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5 checked> <label class="md-nav__link head-type" for=nav-5> Concepts </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-5> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Architecture/ title=Architecture class="md-nav__link head-type"> Architecture </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active head-type" for=__toc> Model </label> <a href=./ title=Model class="md-nav__link md-nav__link--active head-type"> Model </a> <nav class="md-nav md-nav--secondary"> <label class="md-nav__title head-type" for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#mongodb title=MongoDB class="md-nav__link head-type"> MongoDB </a> </li> <li class=md-nav__item> <a href=#configuration title=Configuration class="md-nav__link head-type"> Configuration </a> </li> <li class=md-nav__item> <a href=#data-model title="Data model" class="md-nav__link head-type"> Data model </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#generic-part title="Generic part" class="md-nav__link head-type"> Generic part </a> </li> <li class=md-nav__item> <a href=#table-model title="Table model" class="md-nav__link head-type"> Table model </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#permission-model title="Permission model" class="md-nav__link head-type"> Permission model </a> </li> <li class=md-nav__item> <a href=#name-handling title="Name handling" class="md-nav__link head-type"> Name handling </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Routing/ title=Routing class="md-nav__link head-type"> Routing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class="md-nav__link head-type" for=nav-6> Server </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-6> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Server/Authentication/ title=Authentication class="md-nav__link head-type"> Authentication </a> </li> <li class=md-nav__item> <a href=../../Server/Server/ title=Server class="md-nav__link head-type"> Server </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class="md-nav__link head-type" for=nav-7> Client </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-7> Client </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Client/Components/ title=Components class="md-nav__link head-type"> Components </a> </li> <li class=md-nav__item> <a href=../../Client/Dux/ title=Dux class="md-nav__link head-type"> Dux </a> </li> <li class=md-nav__item> <a href=../../Client/Templates/ title=Templates class="md-nav__link head-type"> Templates </a> </li> <li class=md-nav__item> <a href=../../Client/Lib/ title=Lib class="md-nav__link head-type"> Lib </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class="md-nav__link head-type" for=nav-8> Technology </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-8> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Technology/Tech/ title=Tech class="md-nav__link head-type"> Tech </a> </li> <li class=md-nav__item> <a href=../../Technology/ES6/ title=ES6 class="md-nav__link head-type"> ES6 </a> </li> <li class=md-nav__item> <a href=../../Technology/React/ title=React class="md-nav__link head-type"> React </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class="md-nav__link head-type" for=nav-9> Integration </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-9> Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Integration/API/ title=API class="md-nav__link head-type"> API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class="md-nav__link head-type" for=nav-10> Maintenance </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-10> Maintenance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Maintenance/Deploy/ title=Deploy class="md-nav__link head-type"> Deploy </a> </li> <li class=md-nav__item> <a href=../../Maintenance/Tests/ title=Tests class="md-nav__link head-type"> Tests </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class="md-nav__title head-type" for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#mongodb title=MongoDB class="md-nav__link head-type"> MongoDB </a> </li> <li class=md-nav__item> <a href=#configuration title=Configuration class="md-nav__link head-type"> Configuration </a> </li> <li class=md-nav__item> <a href=#data-model title="Data model" class="md-nav__link head-type"> Data model </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#generic-part title="Generic part" class="md-nav__link head-type"> Generic part </a> </li> <li class=md-nav__item> <a href=#table-model title="Table model" class="md-nav__link head-type"> Table model </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#permission-model title="Permission model" class="md-nav__link head-type"> Permission model </a> </li> <li class=md-nav__item> <a href=#name-handling title="Name handling" class="md-nav__link head-type"> Name handling </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/dans-labs/dariah/edit/master/docs/Concepts/Model.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=model>Model<a class=headerlink href=#model title="Permanent link">&para;</a></h1> <p>This application contains a generic engine to display MongoDB data according to any specified data model, respecting access privileges.</p> <h2 id=mongodb>MongoDB<a class=headerlink href=#mongodb title="Permanent link">&para;</a></h2> <p>We store the data in a <a href=https://docs.mongodb.com>MongoDB</a> .</p> <details class=details><summary>Data as documents</summary><p>A MongoDB does not work with a fixed schema. A MongoDB <em>collection</em> consists of <em>documents</em>, which are essentially JSON-like structures, arbitrarily large and arbitrarily nested. That makes it easy to add new kinds of data to documents and collections when the need arises to do so. This will not break the existing code.</p> <p>MongoDB is optimized to read quickly, at the cost of more expensive data manipulation operations. Its documentation favours storing related data inside the main document. This increases the redundancy of the data and may lead to consistency problems, unless the application tries to enforce consistency somehow.</p> <p>In this app, with a limited amount of data, we use MongoDB primarily for its flexibility. We still adhere largely to SQL-like practices when we deal with related tables. So instead of storing the information of related documents directly inside the main document, we only store references to related documents inside the main documents.</p> </details> <details class=caution open=open><summary>Terminology</summary><p>Because our treatment of data is still very relational, we prefer wording derived from SQL databases, at least in the present documentation:</p> <table> <thead> <tr> <th>MongoDB</th> <th>SQL</th> </tr> </thead> <tbody> <tr> <td><em>collection</em></td> <td><strong>table</strong></td> </tr> <tr> <td><em>document</em></td> <td><strong>record</strong></td> </tr> </tbody> </table> </details> <h2 id=configuration>Configuration<a class=headerlink href=#configuration title="Permanent link">&para;</a></h2> <p>The <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/model.yaml>model</a> and the files in <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables>table</a> are YAML configuration files, and by tweaking them you can achieve a lot of customization.</p> <h2 id=data-model>Data model<a class=headerlink href=#data-model title="Permanent link">&para;</a></h2> <p>The data model has a generic part and a table specific part.</p> <h3 id=generic-part>Generic part<a class=headerlink href=#generic-part title="Permanent link">&para;</a></h3> <p>See <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/model.yaml>model.yaml</a> .</p> <p>Here we define structures and values that are relevant for the system as a whole and/or for all tables:</p> <details class=abstract><summary>defaults</summary><p>Defaults for table models. Whenever a table misses one of the keys listed here, the value here will be filled in for that table.</p> <p>The defaults are suited to tables that act as value lists, of which we have quite a bunch.</p> <p>All these tables need a very short own specification.</p> <p>The meaning of these keys are explained in <a href=#table-model>table configuration</a> .</p> </details> <details class=abstract><summary>provenance</summary><p>Fields for recording the edit history of a record.</p> <details class=details><summary>provenanceOrder</summary><p>Field names for provenance fields in a specific order.</p> </details> <details class=details open=open><summary>provenanceSpecs</summary><p>Field specifications for the provenance fields.</p> <p>We have these fields:</p> <details class=details><summary>editors</summary><p>List of ids of non-owner users that may edit this record, even if their group permissions do not allow it.</p> </details> <details class=details><summary>creator</summary><p>Id of the user that created the record.</p> </details> <details class=details><summary>dateCreated</summary><p>Datetime when the record was created.</p> </details> <details class=details><summary>modified</summary><p>Trail of modification events, each event has the name of the user who caused the change and the datetime when it happened. The trail will be weeded out over time.</p> </details> <p>The field "editors" may be changed by the owner of a record, and by people with higher powers such as the backoffice, not by the editors themselves (unless they also have higher power).</p> <p>All other fields cannot be modified by users, not even by users with higher powers. Only the system itself will write and update these fields.</p> <details class=caution><summary>Backdoors</summary><p>A person with access to the underlying Mongo DB can do with the data what (s)he wants.</p> <p>This requires a direct interaction with the machine on which the database resides. Webaccess is not sufficient.</p> </details> </details> </details> <details class=abstract><summary>generic</summary><p>A few values for the system:</p> <details class=abstract><summary>systemFields</summary><p>The list of provenance fields that the system must manage after each change to a record.</p> <details class=caution><summary>Specs</summary><p>These fields must still be specified in the tables where they occur, including their types.</p> </details> </details> <details class=abstract><summary>noTitle</summary><p>The default title of a record if the title is not given in any other way.</p> </details> </details> <details class=abstract><summary>permissions</summary><p>The mechanics of the group-based permissions system is defined here.</p> <p>See <a href=#permission-model>permission model</a> below.</p> </details> <details class=abstract><summary>workflow</summary><p>See <a href=../../Functionality/Workflow/ >workflow engine</a> .</p> </details> <details class=abstract><summary>names</summary><p>Used in <a href=#name-handling>name handling</a> .</p> </details> <h3 id=table-model>Table model<a class=headerlink href=#table-model title="Permanent link">&para;</a></h3> <p>Everything that the app needs to know about a table is in the table model. For each table that needs specs beyond the default, there is a corresponding model file in the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables>model directory</a> .</p> <p>Here we describe the keys in the table models.</p> <details class=details><summary>title</summary><p>The name of the field that will be used as title when records are listed.</p> </details> <details class=details><summary>item</summary><p>A display name by which we call individual entities, with a value for singular and plural. E.g. for the table <code>country</code> we have as item: <code>country</code> and <code>countries</code>.</p> </details> <details class=details><summary>sort</summary><p>A list of sort keys. A sort key is a pair consisting of a field, and a direction (-1: descending, 1: ascending).</p> </details> <details class=details><summary>fieldOrder</summary><p>A list of the fields, in the order by which will we displayed when the interface presents a record.</p> </details> <details class=details><summary>fieldSpecs</summary><p>A dictionary of the fields and their characteristics, needed to accommodate the display and manipulation of its values. Field names are the keys, the values are themselves dictionaries, containing:</p> <details class=details><summary>label</summary><p>A user-friendly display name of the field.</p> </details> <details class=details><summary>multiple</summary><p>Whether there is only one value allowed for this field, or a list of values.</p> </details> <details class=details><summary>valType</summary><p>The data type of the field and its other behavioural characteristics.</p> <details class=details><summary>Direct values</summary><p>If a field contains an explicit value or list of values, i.e. a value that stands on its own and does not refer to other records, <code>valType</code> is just a string that specifies the type of the field. If the field may contain a list of values (<code>multiple=true</code>), <code>valType</code> specifies the type of a single value.</p> <p>Possible types are:</p> <details class=details><summary>bool</summary><p><code>true</code> or <code>false</code>.</p> </details> <details class=details><summary>datetime</summary><p>A date time, mostly represented in its <a href=https://en.wikipedia.org/wiki/ISO_8601>ISO 8601</a> format.</p> </details> <details class=details><summary>number</summary><p>An integer or real number.</p> </details> <details class=details><summary>text</summary><p>A string of characters, usually just a one-liner.</p> </details> <details class=details><summary>url</summary><p>A syntactically valid URL: i.e. a string of text that can be interpreted as a URL. A validation routine will check this.</p> </details> <details class=details><summary>email</summary><p>A syntactically valid email address. A validation routine will check this.</p> </details> <details class=details><summary>textarea</summary><p>A string of characters, which may extend to several pages. It is assumed that this is Markdown text, and its formatted version will be shown on the interface, see <a href=../../Client/Components/#markdownarea>MarkdownArea</a> .</p> </details> </details> <details class=details><summary>Related values</summary><p>When a field refers to other records, there is much more to specify. In this case <code>valType</code> is a dictionary with the following information:</p> <details class=details><summary>relTable</summary><p>The table that contains the related records.</p> </details> <details class=details><summary>allowNew</summary><p>Whether the user is allowed to enter new records in the related table.</p> </details> <details class=details><summary>popUpIfEmpty</summary><p>(<em>optional: default:</em> <code>false</code>)</p> <p>If an edit view on a record having an empty value for this field is shown, a widget to choose a value will pop up immediately. Otherwise there will be just a control button, inviting you to enter a value.</p> <details class=example><summary>Score</summary><p>See the field <code>score</code> in <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/criteriaEntry.yaml>criteriaEntry.yaml</a> .</p> </details> </details> <details class=details><summary>select</summary><p>A criterion on records in the related table.</p> <p>Only the records that satisfy the criterion specified in <code>select</code>, are allowed values. The criterion may be an arbitrary MongoDb selction constraint.</p> <details class=example><summary>Country</summary><p>The <code>country</code> field in the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/contrib.yaml>contrib table</a> has <code>isMember: true</code>. <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>country</span><span class=p>:</span>
  <span class=nt>perm</span><span class=p>:</span>
    <span class=nt>list</span><span class=p>:</span>   <span class="l l-Scalar l-Scalar-Plain">public</span>
    <span class=nt>read</span><span class=p>:</span>   <span class="l l-Scalar l-Scalar-Plain">public</span>
    <span class=nt>update</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">edit</span>
  <span class=nt>label</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Country</span>
  <span class=nt>valType</span><span class=p>:</span>
    <span class=nt>relTable</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">country</span>
<span class=hll>    <span class=nt>select</span><span class=p>:</span>
</span><span class=hll>      <span class=nt>isMember</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span>    <span class=nt>allowNew</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class=nt>multiple</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div> </td></tr></table></p> <p>So when we choose a country for a contribution, we will be presented with a choice between those countries that are a member of DARIAH.</p> </details> <details class=example><summary>Reviewer</summary><p>The <code>reviewerE</code> field in the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/assessment.yaml>assessment table</a> points to the user table, but it has a <code>select</code> condition:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>reviewerE</span><span class=p>:</span>
  <span class=nt>perm</span><span class=p>:</span>
    <span class=nt>list</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">auth</span>
    <span class=nt>read</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">auth</span>
    <span class=nt>update</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">office</span>
  <span class=nt>label</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Reviewer (1)</span>
  <span class=nt>valType</span><span class=p>:</span>
    <span class=nt>select</span><span class=p>:</span>
<span class=hll>      <span class=nt>authority</span><span class=p>:</span>
</span><span class=hll>        <span class=nt>$ne</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">legacy</span>
</span>    <span class=nt>relTable</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">user</span>
    <span class=nt>allowNew</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">email</span>
  <span class=nt>multiple</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div> </td></tr></table> <p>That means, only users for which the <code>authority</code> field is not <code>legacy</code> can be chosen as reviewer.</p> </details> </details> <details class=details><summary>fixed</summary><p>(<em>optional, default:</em> <code>false</code>)</p> <p>Whether the value of this field is fixed after it has been assigned initially.</p> <p>A fixed field can be assigned a value, and after that it is frozen. If a field is fixed, the user interface will be informed to not provide edit controls for it, and the server will be instructed not to modify this field.</p> <details class=example><summary>assessmentType</summary><p>When an assessment record is created for a contribution, its field <code>assessmentType</code> is copied from the <code>typeContribution</code> field of the master <code>contribution</code> record. Based on that, a fixed set of <code>criteriaEntry</code> records are assembled as details to the <code>assessment</code> record.</p> <p>If the contribution type is changed in a later stage, the <code>assessmentType</code> still shows the type on which the assembly of <code>criteriaEntry</code> records is based.</p> <p>If we would allow the <code>assessmentType</code> to be changed, we have no way to see the type on which the criteria entries are based, therefore, we require it to be immutable after having received its initial value.</p> <details class=details><summary>Way out</summary><p>How to proceed out of such a situation?</p> <p>The system should not delete or change the criteria entry records, because the user may have entered data in it.</p> <p>If the contribution really needs an other type, the best way to proceed is to create a new blank assessment, copy the relevant information over from the old assessment, and then remove the old assessment.</p> </details> </details> </details> <details class=details><summary>inactive</summary><p>(<em>optional</em>)</p> <p>This field relates to <em>active</em>/<em>inactive</em> items, defined in <a href=../../Functionality/Workflow/ >Workflow</a> .</p> <p>Inactive items may have to be rendered in such a way that the user is alerted to the fact that these items are currently a form of legacy content.</p> <p>The <code>inactive</code> dictionary instructs what to do with inactive items:</p> <details class=details><summary>disabled</summary><p>If true, do not present inactive items in choice widgets: so if you modify the value, you cannot choose inactive values.</p> </details> <details class=details><summary>attributes</summary><p>e.g. a CSS <em>className</em> and a HTML <em>title</em> attribute (tooltip) that will be put on the element that renders the item. Any set of valid attributes will do, there are no additional constraints.</p> </details> <details class=example><summary>typeContribution</summary><p>The <code>typeContribution</code> field of a <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/contrib.yaml>contrib record</a> may be obsolete, because it is not specified in the current package (see <a href=../../Functionality/Workflow/ >Workflow</a> .</p> <p>In the <code>valType</code> for this field we see the following specification:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>typeContribution</span><span class=p>:</span>
  <span class=nt>perm</span><span class=p>:</span>
    <span class=nt>list</span><span class=p>:</span>   <span class="l l-Scalar l-Scalar-Plain">public</span>
    <span class=nt>read</span><span class=p>:</span>   <span class="l l-Scalar l-Scalar-Plain">public</span>
    <span class=nt>update</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">edit</span>
  <span class=nt>label</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Type</span>
  <span class=nt>valType</span><span class=p>:</span>
    <span class=nt>relTable</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">typeContribution</span>
    <span class=nt>allowNew</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=hll>    <span class=nt>inactive</span><span class=p>:</span>
</span><span class=hll>      <span class=nt>attributes</span><span class=p>:</span>
</span><span class=hll>        <span class=nt>className</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">inactive</span>
</span><span class=hll>        <span class=nt>title</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">this value does not belong to the current package</span>
</span><span class=hll>      <span class=nt>disabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span>  <span class=nt>multiple</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div> </td></tr></table> <p>This is the rendered HTML for this value:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=p>&lt;</span><span class=nt>a</span>
    <span class=na>href</span><span class=o>=</span><span class=s>&quot;/data/typeContribution/list/item/00000000cca4bbd9fe00000b&quot;</span>
    <span class=na>class</span><span class=o>=</span><span class=s>&quot;tag disabled inactive&quot;</span>
<span class=p>&gt;</span>Tools and Software<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</pre></div> </td></tr></table> </details> </details> </details> <details class=note><summary>Listing related records</summary><p>When we need to show a related record as a single value, we use its <em>title</em> field.</p> <details class=details><summary>Missing title field?</summary><p>The name of the title field is specified by the <code>title</code> entry in the table model, if present, otherwise we look it up from <code>generic</code> dictionary under <code>noTitle</code>.</p> </details> <details class=caution><summary>Custom code for titles</summary><p>The client code may have implemented special code for certain tables, such as <code>user</code>, and <code>country</code>.</p> <p>This happens in this piece of code</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>const</span> <span class=nx>headSwitch</span> <span class=o>=</span> <span class=p>{</span>
  <span class=nx>user</span><span class=o>:</span> <span class=nx>headUser</span><span class=p>,</span>
  <span class=nx>country</span><span class=o>:</span> <span class=nx>headCountry</span><span class=p>,</span>
  <span class=nx>typeContribution</span><span class=o>:</span> <span class=nx>headType</span><span class=p>,</span>
  <span class=nx>score</span><span class=o>:</span> <span class=nx>headScore</span><span class=p>,</span>
  <span class=k>default</span><span class=o>:</span> <span class=nx>headRelated</span><span class=p>,</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p>in <a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/tables.js>tables.js</a> .</p> </details> <details class=note><summary>Value lists</summary><p>In many cases, the related table is a <em>value list</em>: every record consists of an <code>_id</code> field (the standard MongoDB identifier field) and a field called <code>rep</code>, which contains the representation of the value.</p> <p>Value lists may or may not specify custom table information. The default table information in <code>generic</code> is such that the value lists are covered by it.</p> </details> <details class=note><summary>Permissions</summary><p>In all cases, the permissions model is also consulted, because the permissions model has a say in which fields are allowed to reach the client.</p> <details class=example><summary>Creator</summary><p>If a non-authenticated user is shown the creator of a record, (s)he sees information from the <code>user</code> table. But the permissions are such that (s)he may not see the email address of that user. So the email address does not even reach the client.</p> </details> </details> </details> </details> <details class=details><summary>grid</summary><p>Specifies how to lay out the table in a grid by means of CSS <a href>flex</a> attributes:</p> <details class=details><summary>width</summary><p>The intended width of the column in which this field is presented;</p> </details> <details class=details><summary>grow</summary><p>(<em>optional: default:</em> <code>0</code>)</p> <p>The degree by which the column width is allowed to increase.</p> </details> <details class=details><summary>shrink</summary><p>(<em>optional: default:</em> <code>0</code>)</p> <p>The degree by which the column width is allowed to decrease.</p> </details> <details class=example><summary>Country</summary><p>The list of countries is typically displayed in a grid.</p> <p>The <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/country.yaml>country model</a> lays out its columns as follows:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>iso</span><span class=p>:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=hll>  <span class="l l-Scalar l-Scalar-Plain">grid</span><span class="p p-Indicator">:</span>
</span><span class=hll>    <span class=nt>width</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">2em</span>
</span><span class=hll>    <span class=nt>grow</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span class=nt>name</span><span class=p>:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=hll>  <span class="l l-Scalar l-Scalar-Plain">grid</span><span class="p p-Indicator">:</span>
</span><span class=hll>    <span class=nt>width</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10em</span>
</span><span class=hll>    <span class=nt>grow</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span class=nt>isMember</span><span class=p>:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=hll>  <span class="l l-Scalar l-Scalar-Plain">grid</span><span class="p p-Indicator">:</span>
</span><span class=hll>    <span class=nt>width</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">4em</span>
</span><span class=hll>    <span class=nt>grow</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span class=nt>latitude</span><span class=p>:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=hll>  <span class="l l-Scalar l-Scalar-Plain">grid</span><span class="p p-Indicator">:</span>
</span><span class=hll>    <span class=nt>width</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">4em</span>
</span><span class=hll>    <span class=nt>grow</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
</span><span class=hll>    <span class=nt>shrink</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span class=nt>longitude</span><span class=p>:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=hll>  <span class="l l-Scalar l-Scalar-Plain">grid</span><span class="p p-Indicator">:</span>
</span><span class=hll>    <span class=nt>width</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">4em</span>
</span><span class=hll>    <span class=nt>grow</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0.5</span>
</span><span class=hll>    <span class=nt>shrink</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</span></pre></div> </td></tr></table> </details> </details> <details class=details><summary>valid</summary><p>The name of a client-side validation function by which new and modified values for this field are validated.</p> <p>The validators are exposed in <a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/lib/fields.js>fields.js</a> as member functions of a <code>validation</code> object.</p> <details class=example><summary>Country</summary><p>The field <code>iso</code> in the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/country.yaml>country table</a> is subjected to the <code>isoCountry()</code> validation function:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>iso</span><span class=p>:</span>
  <span class=nt>perm</span><span class=p>:</span>
    <span class=nt>list</span><span class=p>:</span>   <span class="l l-Scalar l-Scalar-Plain">public</span>
    <span class=nt>read</span><span class=p>:</span>   <span class="l l-Scalar l-Scalar-Plain">public</span>
    <span class=nt>update</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">office</span>
  <span class=nt>label</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ISO(2)</span>
  <span class=nt>valType</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
<span class=hll>  <span class=nt>valid</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">isoCountry</span>
</span>  <span class=nt>multiple</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class=nt>grid</span><span class=p>:</span>
    <span class=nt>width</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">2em</span>
    <span class=nt>grow</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div> </td></tr></table> <p>This function can be found in <a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/lib/datatypes.js>datatypes.js</a> as a member of the (exported) <code>validation</code> object.</p> </details> <details class=caution><summary>Server validation</summary><p>The server carries out extensive, non-customizable validation as well, in order to protect the integrity of the database.</p> </details> </details> </details> <details class=abstract><summary>details</summary><p>Specification of detail records: where are they and how are they connected to their masters?</p> <details class=explanation><summary>master-detail</summary><p>A record may have <em>detail records</em> associated with it. We call such a record a <em>master record</em> with respect to its details.</p> <p>Details are records, usually in another table, having a field that points to their master record by means of an <code>_id</code> value.</p> </details> <details class=explanation><summary>multiple kinds of details</summary><p>A master record may have multiple kinds of detail records, i.e. detail records from several distinct tables. It is also possible to specify multiple kinds from one and the same originating table.</p> <p>To each kind of detail, a name is given, often this name is the same as the name of table in which the details are found.</p> </details> <details class=explanation><summary>Detail display</summary><p>When a master record is presented in full view, all of its fields are expanded with their values.</p> <p>Below that there are lists of head lines of detail records, sorted by their kind.</p> </details> <p>The detail specifications consist of:</p> <details class=details><summary>table</summary><p>The name of the originating table.</p> </details> <details class=details><summary>linkField</summary><p>The name of the field in the originating table that links to the master record.</p> </details> <details class=details><summary>mode</summary><p>The display mode of the detal records:</p> <table> <thead> <tr> <th>name</th> <th>meaning</th> </tr> </thead> <tbody> <tr> <td><code>list</code></td> <td>plain list of record head lines</td> </tr> <tr> <td><code>grid</code></td> <td>table of full records in grid view</td> </tr> </tbody> </table> </details> <details class=details><summary>filtered</summary><p>Whether the detais of this kind should have filter controls. If yes, the filters are taken from the specification of the originating table.</p> </details> <details class=details><summary>expand</summary><p>(<em>optional, default:</em> <code>false</code>)</p> <p>If this is true, all detail records of this kind will be immediately expanded. Normally, detail records are presented as head lines initially.</p> </details> <details class=details><summary>border</summary><p>(<em>optional, default:</em> <code>read: true, edit: true</code>)</p> <p>Whether to put a border around each individual detail record of this kind. This feature must be specified for the read-only presentation and the editable presentation separately, by means of the keys <code>read</code> and <code>edit</code>.</p> <details class=example><summary>criteriaEntry</summary><p>The criteriaEntry details of an <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/assessment.yaml>assessment record</a> will be displayed without borders, thereby strengthening the impression that they constitute a single form.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>details</span><span class=p>:</span>
  <span class=nt>criteriaEntry</span><span class=p>:</span>
    <span class=nt>table</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">criteriaEntry</span>
    <span class=nt>linkField</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">assessment</span>
    <span class=nt>expand</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">own</span>
    <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
<span class=hll>    <span class=nt>border</span><span class=p>:</span> <span class="p p-Indicator">{</span>
</span><span class=hll><span class=nt>      read</span><span class=p>:</span> <span class=nv>false</span><span class="p p-Indicator">,</span>
</span><span class=hll><span class=nt>      edit</span><span class=p>:</span> <span class=nv>false</span><span class="p p-Indicator">,</span>
</span><span class=hll>    <span class="p p-Indicator">}</span>
</span>    <span class=nt>filtered</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>cascade</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>fixed</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div> </td></tr></table> </details> </details> <details class=details><summary>cascade</summary><p>(<em>optional, default:</em> <code>false</code>)</p> <p>When the master record is deleted, its details have a dangling reference to a non-existing master record. In some cases it is desirable to delete the detail records as well.</p> <p>If <code>cascade: true</code>, the detail records of this kind will be deleted together with the master record.</p> <details class=example><summary>criteriaEntry</summary><p>In the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/assessment.yaml>assessment model</a> it is stated that criteriaEntry records are deleted with their master record.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>details</span><span class=p>:</span>
  <span class=nt>criteriaEntry</span><span class=p>:</span>
    <span class=nt>table</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">criteriaEntry</span>
    <span class=nt>linkField</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">assessment</span>
    <span class=nt>expand</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">own</span>
    <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
    <span class=nt>border</span><span class=p>:</span> <span class="p p-Indicator">{</span>
<span class=nt>      read</span><span class=p>:</span> <span class=nv>false</span><span class="p p-Indicator">,</span>
<span class=nt>      edit</span><span class=p>:</span> <span class=nv>false</span><span class="p p-Indicator">,</span>
    <span class="p p-Indicator">}</span>
    <span class=nt>filtered</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=hll>    <span class=nt>cascade</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span>    <span class=nt>fixed</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div> </td></tr></table> </details> <details class=example><summary>criteria</summary><p>In the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/package.yaml>package model</a> it is stated that criteria records are <em>not</em> deleted with their master record, bacause there is no <code>cascade: true</code>.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>details</span><span class=p>:</span>
  <span class=nt>criteria</span><span class=p>:</span>
    <span class=nt>table</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">criteria</span>
    <span class=nt>linkField</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">package</span>
    <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
    <span class=nt>filtered</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div> </td></tr></table> </details> </details> <details class=details><summary>fixed</summary><p>(<em>optional, default:</em> <code>false</code>)</p> <p>Whether the list of details of this kind is fixed.</p> <p>Details of a kind are fixed, if, after having been created, no details may be added or removed. Individual details may still be modified.</p> <details class=example><summary>Assessments and criteria entries</summary><p>Once an <code>assessment</code> record for a contribution has been created, a special <a href=../../Functionality/Workflow/ >workflow</a> takes care to lookup the list of criteria that apply to this contribution, based on its <code>typeContribution</code> field.</p> <details class=details><summary>read from package</summary><p>This mapping is read from the <code>criteria</code> detail records of the currently active <code>package</code> records).</p> </details> <p>For each criterion a <code>criteriaEntry</code> detail record is added to the master <code>assessment</code> record.</p> <p>After that, the list of <code>criteriaEntries</code> for this <code>assessment</code> record may not change anymore. But the user is still be able to fill out the <code>criteriaEntry</code> records.</p> <p>This is accomplished by <code>fixed: true</code> in</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>details</span><span class=p>:</span>
  <span class=nt>criteriaEntry</span><span class=p>:</span>
    <span class=nt>table</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">criteriaEntry</span>
    <span class=nt>linkField</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">assessment</span>
    <span class=nt>expand</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">own</span>
    <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">list</span>
    <span class=nt>border</span><span class=p>:</span> <span class="p p-Indicator">{</span>
<span class=nt>      read</span><span class=p>:</span> <span class=nv>false</span><span class="p p-Indicator">,</span>
<span class=nt>      edit</span><span class=p>:</span> <span class=nv>false</span><span class="p p-Indicator">,</span>
    <span class="p p-Indicator">}</span>
    <span class=nt>filtered</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>cascade</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=hll>    <span class=nt>fixed</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span></pre></div> </td></tr></table> <p>See the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/assessment.yaml>assessment model</a> .</p> </details> </details> </details> <details class=details><summary>detailOrder</summary><p>The order in which details are displayed below their master record is given in the key <code>detailOrder</code>.</p> </details> <details class=abstract><summary>needMaster</summary><p><em>optional: default:</em> <code>false</code>.</p> <p>Some tables act as containers for detail records exclusively, and it makes no sense to create a detail record if there is no master record to point to.</p> <p>If that is the case, specify <code>needMaster: true</code>, otherwise, leave it out.</p> <details class=details><summary>Presentation</summary><p>If <code>needMaster: true</code>, there will be no plus button (insert item) when the records are displayed as a main list. Only when they are displayed as a list of details to some master record, the plus button will appear.</p> </details> <details class=example><summary>Assessment</summary><p>Assessments can only be created as detail of a <code>contribution</code>.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=hll><span class=nt>needMaster</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span></pre></div> </td></tr></table> <p>See the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/assessment.yaml>assessment model</a> .</p> </details> <details class=example><summary>Package</summary><p>Packages can be seen as details of <code>typeContribution</code>, in the sense that for each contribution type, there is a list of packages to tell when that contribution type was valid and which criteria were associated with it.</p> <p>Yet a package record makes sense on its own.</p> <p>When you create it, you do not have to select a contribution type first.</p> <p>Rather, you create a package, and in its <code>typeContribution</code> field you select a number of contribution types.</p> </details> </details> <details class=abstract><summary>filters</summary><p>A list of filters by which to constrain the set of records to be displayed. There are <em>fulltext</em> filters and <em>faceted</em> filters.</p> <p>Each filter is a dictionary with the following information:</p> <details class=details><summary>field</summary><p>The name of the field to be filtered.</p> </details> <details class=details><summary>relField</summary><p>(<em>optional</em>)</p> <p>If <code>field</code> has values that are identifiers pointing to a related tables, <code>relField</code> specifies which field in the related table should be filtered.</p> <details class=example><summary>criteriaEntry</summary></details> <p>If you want to filter <code>criteriaEntry</code> records on their <code>score</code>, you are faced with the fact that scores live in a separate table. The <code>criteriaEntry</code> records contain just an <code>_id</code> into the table <code>score</code>.</p> <p>The actual score is contained in the field <code>score</code> of that table. Hence, if we want to filter on actual scores, we say</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>filters</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>field</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">score</span>
<span class=hll>    <span class=nt>relField</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">score</span>
</span>    <span class=nt>label</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">score</span>
    <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ByValue</span>
    <span class=nt>maxCols</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class=nt>expanded</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div> </td></tr></table> <p>See the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/criteriaEntry.yaml>criteriaEntry model</a> .</p> </details> <details class=details><summary>label</summary><p>A user friendly name for the filter, usually the label of the field to be filtered.</p> </details> <details class=details><summary>type</summary><p>The type of filter:</p> <table> <thead> <tr> <th>filter type</th> <th>widget</th> </tr> </thead> <tbody> <tr> <td><code>ByValue</code></td> <td>faceted browsing</td> </tr> <tr> <td><code>EUMap</code></td> <td>faceted, plus a visualisation on the map of Europe</td> </tr> <tr> <td><code>Fulltext</code></td> <td>full text search in the field values</td> </tr> </tbody> </table> </details> <details class=details><summary>maxCols</summary><p>(<em>not needed for <code>Fulltext</code> filters</em>)</p> <p>Facets are displayed in a table with at most this amount of columns.</p> </details> <details class=details><summary>expanded</summary><p>(<em>not needed for <code>Fulltext</code> filters</em>)</p> <p>Whether the table of facets is initially expanded or collapsed.</p> </details> </details> <h2 id=permission-model>Permission model<a class=headerlink href=#permission-model title="Permanent link">&para;</a></h2> <p>The authorization system is built on the basis of <em>groups</em> and <em>permission</em> levels.</p> <p><em>Users</em> are assigned to groups, and <em>things</em> require permission levels.</p> <p>When a user wants to act upon a thing, his/her group will be compared to the permission level of the thing, and based on the outcome of the comparison, the action will be allowed or forbidden.</p> <p>The configuration of the permissions system as a whole is in <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/model.yaml>model</a> , under the key <code>permissions</code>, and the table-specific permissions are under the <code>perm</code> keys of the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables>table model files</a> .</p> <details class=abstract><summary>Groups (informally)</summary><p>Groups are attributes of users, as an indication of the power they have.</p> <p>Informally, we need to distinguish between:</p> <details class=details><summary>Nobody</summary><p>A group without users, and if there were users, they could not do anything.</p> <p>Useful in cases where you want to state that something is not permitted to anybody.</p> </details> <details class=details><summary>The public</summary><p>Unidentified an unauthenticated users.</p> <p>They can only list/read public information and have no right to edit anything and can do no actions that change anything in the database.</p> </details> <details class=details><summary>Authenticated users</summary><p>DARIAH users authenticated by the DARIAH Identity provider.</p> <p>This is the default group for logged-in users.</p> <p>They can see DARIAH internal information (within limits) an can add items and then modify/delete them, within limits.</p> </details> <details class=details><summary>National coordinators</summary><p>DARIAH users that coordinate the DARIAH outputs for an entire member country.</p> <p>They can (de)select contributions and see their cost fields but only for contributions in the countries they coordinate.</p> </details> <details class=details><summary>Backoffice employees</summary><p>Users that work for the DARIAH ERIC office.</p> <p>They can modify records created by others (within limits), but cannot perform technical actions that affect the system.</p> </details> <details class=details><summary>System managers</summary><p>Users that control the system, not only through the interface of the app, but also with low-level access to the database and the machine that serves the app.</p> <p>Can modify system-technical records, within limits.</p> </details> <details class=details><summary>root</summary><p>One user that can bootstrap the system.</p> <p>Complete rights. Still there are untouchable things, that would compromise the integrity of the system. Even root cannot modify those from within the system.</p> <p>Root is the owner of the system, and can assign people to the roles of system managers and backoffice employees.</p> <p>From there on, these latter groups can do everything that is needed for the day-to-day operation of the functions that the system is designed to fulfill.</p> </details> <details class=caution><summary>Pseudo groups</summary><p>In some cases, the identity of the user is relevant, namely when users have a special relationship to the records they want to modify, such as <em>ownership</em>, <em>editorship</em>, etc. When those relationships apply, users are put in a pseudo group such <em>own</em> or <em>edit</em>.</p> <p>In yet other cases, when users change the permission levels of users, the permission levels of both users need to be taken into account.</p> </details> </details> <details class=abstract><summary>Assigning users to groups</summary><p>Once users are in a group, their permissions are known. But there are also permissions to regulate who may assign groups to users. These permissions derive from the groups as well, with a few additional rules:</p> <ul> <li>nobody can assign anybody to the group <code>nobody</code>;</li> <li>a person can only add people to groups that have at most his/her own power;</li> <li>a person can only assign groups to people that have less power than him/herself.</li> </ul> <details class=example><summary>Example</summary><ul> <li>If you are <code>office</code>, you cannot promote yourself or anyone else to <code>system</code> or <code>root</code>.</li> <li>If you are <code>office</code>, you cannot demote another member of <code>office</code> to the group <code>auth</code>.</li> <li>You cannot demote/promote your peers, or the ones above you.</li> <li>You can demote yourself, but not promote yourself.</li> <li>You can demote people below you.</li> <li>You can promote people below you, but only up to your own level.</li> </ul> </details> </details> <details class=abstract><summary>Groups (formally)</summary><details class=abstract><summary>Authenticated versus unauthenticated users</summary><p>The keys <code>auth</code> and <code>unauth</code> point to the names the groups to which authenticated and unauthenticated users are assigned by default (respectively).</p> </details> <p>Under the key <code>groups</code> the groups and pseudo groups are given, with a short description. </p> <table> <thead> <tr> <th>group</th> <th>is pseudo</th> <th>description</th> </tr> </thead> <tbody> <tr> <td>public</td> <td>no</td> <td>user, not logged in</td> </tr> <tr> <td>auth</td> <td>no</td> <td>authenticated user</td> </tr> <tr> <td>our</td> <td>yes</td> <td>authenticated user and mentioned in a specific field of records in question</td> </tr> <tr> <td>edit</td> <td>yes</td> <td>authenticated user and editor of records in question</td> </tr> <tr> <td>own</td> <td>yes</td> <td>authenticated user and creator of records in question</td> </tr> <tr> <td>coord</td> <td>no</td> <td>national coordinator</td> </tr> <tr> <td>office</td> <td>no</td> <td>back office user</td> </tr> <tr> <td>system</td> <td>no</td> <td>system administrator</td> </tr> <tr> <td>root</td> <td>no</td> <td>full control</td> </tr> <tr> <td>nobody</td> <td>no</td> <td>deliberately empty: no user is member of this group</td> </tr> </tbody> </table> <details class=details><summary>our</summary><p>the user is mentioned in specific fields of the record. Which fields? See the <code>ourFields</code> key in the yaml file for that table.</p> <details class=example><summary>assessments</summary><p><a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables/assessment.yaml>assessment.yaml</a></p> </details> </details> </details> <details class=abstract><summary>Levels</summary><p><em>Levels</em> are attributes of things: methods, tables, records, fields, as an indication of the power needed to act upon them.</p> <p>Under the key <code>levels</code> the <em>levels</em> are given, in the order: more powerful before less powerful.</p> <ul> <li>public</li> <li>auth</li> <li>our</li> <li>OUR</li> <li>edit</li> <li>EDIT</li> <li>own </li> <li>OWN</li> <li>coord</li> <li>office</li> <li>system</li> <li>root</li> <li>nobody</li> </ul> <details class=note><summary>Capitalized pseudo groups</summary><p>The levels correspond largely to the groups, but there are a few capitalized variants of the pseudo groups.</p> <p>They come into play when users with higher powers want to access items.</p> <p>For example, a backoffice user is entitled to edit items which require level <code>own</code> for that, even if they are other people's items. This is because the power of a backoffice user exceeds the level <code>own</code>.</p> <p>But if you want to display a button <code>my items</code>, which lists the items <code>own</code>ed by the current user. The obvious thing to do, is to assign a permission level <code>own</code> to the action <code>list</code>.</p> <p>That works fine for normal, authenticated users. But a backoffice user will see <em>all</em> items nevertheless.</p> <p>This is where <code>OWN</code> comes in. The capitalized form states that the <code>own</code>ership condition outweighs the <code>office</code> potential.</p> <p>Thus, if the <code>list</code> action reuqires <code>OWN</code> permission, only records whose owner is the current user are listed.</p> <p>The same logic applies to <code>OUR</code> and <code>EDIT</code>.</p> </details> <details class=note><summary><code>ownLT</code></summary><p>This is a very special pseudo-level. It requires that the user acting on the item is either the owner or is more powerful than the owner of the record.</p> <p>This is only applicable to the <code>group</code> field in the <code>user</code> table.</p> <p>In this way it is enforced that lower power users can not affect what higher power users can do.</p> </details> </details> <details class=abstract><summary>Actions</summary><p>Methods give rise to <em>actions</em>, listed in under the key <code>actions</code>:</p> <table> <thead> <tr> <th>action</th> <th>description</th> </tr> </thead> <tbody> <tr> <td>insert</td> <td>create item</td> </tr> <tr> <td>list</td> <td>read item title</td> </tr> <tr> <td>read</td> <td>read item</td> </tr> <tr> <td>set</td> <td>give item initial value</td> </tr> <tr> <td>update</td> <td>update item</td> </tr> <tr> <td>delete</td> <td>delete item</td> </tr> </tbody> </table> <details class=note><summary><code>read</code> versus <code>list</code></summary><p>An item may allow <code>list</code> to <em>public</em> but not <code>read</code>. In that case, unauthenticated users may see the list of items, usually their titles, but they cannot drill down to see the full details of records.</p> </details> <details class=note><summary><code>set</code> versus <code>update</code></summary><p>The <code>set</code> action changes a value from <code>null</code>, <code>None</code>, or <code>undefined</code> to a defined value. It cannot change a defined value into another value. So <code>set</code> is a limited <code>update</code> action. <code>update</code> can change any value, including an undefined value, into any other value, including an undefined value.</p> </details> </details> <details class=abstract><summary>Things</summary><p>These are the things that may require permission levels:</p> <details class=details><summary>Methods</summary><p>If a user needs to do something, (s)he interacts with the user interface at the client. That will lead to an API call to the server, which will translate into the invocation of a <em>method</em>. At that point, the first check will be made: is this user allowed to invoke this method? The check is performed on the basis of the <code>methods</code> table, which is a dictionary of method names. For each method name a description is given, and the level required to invoke that method.</p> <table> <thead> <tr> <th>method</th> <th>level</th> <th>description</th> </tr> </thead> <tbody> <tr> <td>mylist</td> <td>EDIT</td> <td>list my items</td> </tr> <tr> <td>ourlist</td> <td>OUR</td> <td>list our items</td> </tr> <tr> <td>list</td> <td>public</td> <td>list all items</td> </tr> <tr> <td>view</td> <td>public</td> <td>details of an item</td> </tr> <tr> <td>mod</td> <td>edit</td> <td>modify (insert/update/delete) an item</td> </tr> <tr> <td>resetwf</td> <td>system</td> <td>reset the workflow information</td> </tr> </tbody> </table> </details> <details class=details><summary>Tables and fields</summary><p>For every table and every field in it, we specify access levels. That means: for every <em>action</em> on that field we state the required access level.</p> <details class=explanation><summary>Authorization logic</summary><ol> <li>the access level for invoking the method is checked;</li> <li>if allowed, the actions that the method is going to perform on which tables are considered;</li> <li>for every (table-action) combination a row filter and a field filter is constructed, restricting the action to only those rows and fields that are permitted to the user; this might be an empty set;</li> <li>if the set is not empty, the action is executed on those rows and those fields that pass the filters.</li> </ol> </details> <details class=explanation><summary>Row and field filters</summary><p>The <code>perm</code> key in the model file of a particular table states the permission level for actions on that table as a whole. This will be checked first.</p> <p>From this a row filter is computed, selecting those rows that may undergo the action.</p> <p>Then there is also a <code>perm</code> section in the field specification for each field in the table.</p> <p>From this a field filter is co,puted, selecting those fields that may undergo the action.</p> </details> </details> </details> <details class=abstract><summary>Authorization</summary><p>Actions may proceed if the user shows a <em>group</em> that matches somehow the <em>level</em> required by the action and the things affected.</p> <p>The <em>matches somehow</em> is specified by a table whose first key is the group, whose second key is the level, and whose value is a number.</p> <p>If the number is <code>0</code>, or if the combination of group and level is missing, the action is not allowed.</p> <p>If the number is positive, it is always <code>1</code>, and the action is allowed.</p> <p>If the number is negative, the action maybe allowed, depending on subsequent conditions, indicated by the value of the nagative number.</p> <details class=details><summary>Subsequent conditions</summary><table> <thead> <tr> <th>value</th> <th>condition</th> </tr> </thead> <tbody> <tr> <td><code>-1</code></td> <td>only if the user is owner of the record</td> </tr> <tr> <td><code>-2</code></td> <td>only if the user is editor of the record</td> </tr> <tr> <td><code>-3</code></td> <td>only if the user is mentioned in some specific fields of the record</td> </tr> <tr> <td><code>-4</code></td> <td>only if the user is from the same country as the country field in the record</td> </tr> </tbody> </table> </details> <details class=details><summary>Authorization table</summary><p>The mapping is under the key <code>authorize</code>.</p> <table> <thead> <tr> <th>group</th> <th>level</th> <th>authorization</th> </tr> </thead> <tbody> <tr> <td>public</td> <td>public</td> <td>1</td> </tr> <tr> <td>auth</td> <td>public</td> <td>1</td> </tr> <tr> <td>auth</td> <td>auth</td> <td>1</td> </tr> <tr> <td>auth</td> <td>coord</td> <td>0</td> </tr> <tr> <td>auth</td> <td>our</td> <td>-3</td> </tr> <tr> <td>auth</td> <td>OUR</td> <td>-3</td> </tr> <tr> <td>auth</td> <td>edit</td> <td>-2</td> </tr> <tr> <td>auth</td> <td>EDIT</td> <td>-2</td> </tr> <tr> <td>auth</td> <td>own</td> <td>-1</td> </tr> <tr> <td>auth</td> <td>OWN</td> <td>-1</td> </tr> <tr> <td>auth</td> <td>ownLT</td> <td>-1</td> </tr> <tr> <td>coord</td> <td>public</td> <td>1</td> </tr> <tr> <td>coord</td> <td>auth</td> <td>1</td> </tr> <tr> <td>coord</td> <td>coord</td> <td>-4</td> </tr> <tr> <td>coord</td> <td>our</td> <td>-3</td> </tr> <tr> <td>coord</td> <td>OUR</td> <td>-3</td> </tr> <tr> <td>coord</td> <td>edit</td> <td>-2</td> </tr> <tr> <td>coord</td> <td>EDIT</td> <td>-2</td> </tr> <tr> <td>coord</td> <td>own</td> <td>-1</td> </tr> <tr> <td>coord</td> <td>OWN</td> <td>-1</td> </tr> <tr> <td>coord</td> <td>ownLT</td> <td>-1</td> </tr> <tr> <td>office</td> <td>public</td> <td>1</td> </tr> <tr> <td>office</td> <td>auth</td> <td>1</td> </tr> <tr> <td>office</td> <td>coord</td> <td>1</td> </tr> <tr> <td>office</td> <td>our</td> <td>1</td> </tr> <tr> <td>office</td> <td>OUR</td> <td>-3</td> </tr> <tr> <td>office</td> <td>edit</td> <td>1</td> </tr> <tr> <td>office</td> <td>EDIT</td> <td>-2</td> </tr> <tr> <td>office</td> <td>own</td> <td>1</td> </tr> <tr> <td>office</td> <td>OWN</td> <td>-1</td> </tr> <tr> <td>office</td> <td>ownLT</td> <td>1</td> </tr> <tr> <td>office</td> <td>office</td> <td>1</td> </tr> <tr> <td>system</td> <td>public</td> <td>1</td> </tr> <tr> <td>system</td> <td>auth</td> <td>1</td> </tr> <tr> <td>system</td> <td>coord</td> <td>1</td> </tr> <tr> <td>system</td> <td>our</td> <td>1</td> </tr> <tr> <td>system</td> <td>OUR</td> <td>-3</td> </tr> <tr> <td>system</td> <td>edit</td> <td>1</td> </tr> <tr> <td>system</td> <td>EDIT</td> <td>-2</td> </tr> <tr> <td>system</td> <td>own</td> <td>1</td> </tr> <tr> <td>system</td> <td>OWN</td> <td>-1</td> </tr> <tr> <td>system</td> <td>ownLT</td> <td>1</td> </tr> <tr> <td>system</td> <td>office</td> <td>1</td> </tr> <tr> <td>system</td> <td>system</td> <td>1</td> </tr> <tr> <td>root</td> <td>public</td> <td>1</td> </tr> <tr> <td>root</td> <td>auth</td> <td>1</td> </tr> <tr> <td>root</td> <td>coord</td> <td>1</td> </tr> <tr> <td>root</td> <td>our</td> <td>1</td> </tr> <tr> <td>root</td> <td>OUR</td> <td>-3</td> </tr> <tr> <td>root</td> <td>edit</td> <td>1</td> </tr> <tr> <td>root</td> <td>EDIT</td> <td>-2</td> </tr> <tr> <td>root</td> <td>own</td> <td>1</td> </tr> <tr> <td>root</td> <td>OWN</td> <td>-1</td> </tr> <tr> <td>root</td> <td>ownLT</td> <td>1</td> </tr> <tr> <td>root</td> <td>office</td> <td>1</td> </tr> <tr> <td>root</td> <td>system</td> <td>1</td> </tr> </tbody> </table> </details> <details class=note><summary><code>nobody</code></summary><p>Note that users in group <code>nobody</code> have no rights. There should be no users in that group, but if by misconfiguration there is a user in that group, (s)he can do nothing.</p> </details> <details class=caution><summary><code>root</code></summary><p>A consequence of the promotion/demotion rules is that if there is no user in the group <code>root</code>, nobody can be made <code>root</code> from within the system.</p> <p>When importing data into the system by means of <a href=https://github.com/Dans-labs/dariah/blob/master/static/tools/load.sh>load.sh</a> you can specify to make a specific user <code>root</code>. Which user that is, is specified in <a href=https://github.com/Dans-labs/dariah/blob/master/static/tools/config.yaml>config.yaml</a> , see <code>rootUser</code>.</p> <p>Once the root user is in place, (s)he can assign system admins and back office people. Once those are in place, the daily governance of the system can take place.</p> </details> </details> <h2 id=name-handling>Name handling<a class=headerlink href=#name-handling title="Permanent link">&para;</a></h2> <details class=details><summary>The problem</summary><p>There are a lot of names in these yaml files. The most obvious way to use them in our programs (Python on the server, JavaScript on the client) is by just mentioning them as strings, e.g.:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>title</span> <span class=o>=</span> <span class=n>DM</span><span class=p>[</span><span class=s1>&#39;tables&#39;</span><span class=p>][</span><span class=s1>&#39;permissionGroup&#39;</span><span class=p>][</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</pre></div> </td></tr></table> <p>and</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nx>title</span> <span class=o>=</span> <span class=nx>DM</span><span class=p>.</span><span class=nx>tables</span><span class=p>.</span><span class=nx>permissionGroup</span><span class=p>.</span><span class=nx>title</span>
</pre></div> </td></tr></table> <p>or</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>tables</span><span class=o>:</span> <span class=p>{</span> <span class=nx>permissionGroup</span><span class=o>:</span> <span class=p>{</span> <span class=nx>title</span> <span class=p>}</span> <span class=p>}</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>DM</span>
</pre></div> </td></tr></table> <p>But then the question arises: how can we use these names in our programs in such a way that we are protected agains typos?</p> </details> <details class=details><summary>Partial solution</summary><p>We tackle this problem in the server code, but not in the client code.</p> <details class=abstract><summary>Python</summary><p>Well, we convert the <code>.yaml</code> model files to Python modules that expose the same model, but now as Python data structure. This is done by means of the <a href=https://github.com/Dans-labs/dariah/blob/master/server/compile.py>compile.py</a> script, just before starting the server. That enables us to collect the names and generate some code. Every part of the <code>.yaml</code> files that may act as a name, is collected. We generate a module <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/compiled/names.py>names.py</a> that defined an object <code>N</code> that contains a member</p> <p><em>name</em> <code>= '</code><em>name</em><code>'</code></p> <p>for each <em>name</em>.</p> <p>This module of names will be imported whenever the models are imported. So whenever we want to refer to a name in one of the models, we have a Python variable in our name space that is equal to that name prepended with <code>N.</code>. By consequently using <code>N.</code><em>names</em> instead of plain strings, we guard ourselves against typos, because the Python parser will complain about undefined variables.</p> <p>Moreover, the same <a href=https://github.com/Dans-labs/dariah/blob/master/server/compile.py>compile.py</a> module also checks all the code in the controllers directory for names:</p> <ul> <li>whether every <code>N.</code><em>name</em> is defined in the <code>names.py</code> and</li> <li>if there are occurrences of plain strings for which an <code>N.</code><em>name</em> is defined.</li> </ul> <p>This solves the case for the Python server code.</p> </details> <details class=abstract><summary>Javascript</summary><p>For the client JavaScript code we do not have such measures. We could do the same approach, but that would severely uglify the code:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nx>title</span> <span class=o>=</span> <span class=nx>DM</span><span class=p>[</span><span class=nx>N</span><span class=p>.</span><span class=nx>tables</span><span class=p>][</span><span class=nx>N</span><span class=p>.</span><span class=nx>permissionGroup</span><span class=p>][</span><span class=nx>N</span><span class=p>.</span><span class=nx>title</span><span class=p>]</span>
</pre></div> </td></tr></table> <p>or</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>const</span> <span class=p>{</span> <span class=p>[</span><span class=nx>N</span><span class=p>.</span><span class=nx>tables</span><span class=p>]</span><span class=o>:</span> <span class=p>{</span> <span class=p>[</span><span class=nx>N</span><span class=p>.</span><span class=nx>permissionGroup</span><span class=p>]</span><span class=o>:</span> <span class=p>{</span> <span class=p>[</span><span class=nx>N</span><span class=p>.</span><span class=nx>title</span><span class=p>]</span><span class=o>:</span> <span class=nx>title</span> <span class=p>}</span> <span class=p>}</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>DM</span>
</pre></div> </td></tr></table> <p>Especially the replacement of</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=p>{</span> <span class=nx>name</span> <span class=p>}</span>
</pre></div> </td></tr></table> <p>by</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=p>{</span> <span class=p>[</span><span class=nx>N</span><span class=p>.</span><span class=nx>name</span><span class=p>]</span><span class=o>:</span> <span class=nx>name</span> <span class=p>}</span>
</pre></div> </td></tr></table> <p>really hurts. So we do not do anything here, and rely on debugging away the typos the hard way.</p> </details> </details> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../Architecture/ title=Architecture class="md-flex md-footer-nav__link md-footer-nav__link--prev head-type" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> Architecture </span> </div> </a> <a href=../Routing/ title=Routing class="md-flex md-footer-nav__link md-footer-nav__link--next head-type" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> Routing </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-disclaimer> The content of this site is produced under responsibility of project <b>Dans-labs/dariah</b> and is subject to change. </div> <div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> customised by <a href=https://github.com/Dans-labs>Dans-labs</a> </div> </div> <div class=md-footer-dans> <div>DANS is an institute of KNAW and NWO</div> <div> <a href=https://dans.knaw.nl/en title="Data Archiving and Networked Services (DANS)"><img class=md-footer-dans__img src=../../assets/images/DANS.gif height=50></a> <a target=_blank href=https://www.knaw.nl/en><img src=../../assets/images/knaw.png height=50></a> <a target=_blank href=https://www.nwo.nl/en><img src=../../assets/images/nwo.png height=50></a> </div> <div><i>Driven by data</i></div> </div> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <style>.md-footer-social__desc{font-family:"Open Sans",sans-serif;-webkit-font-smoothing:auto}</style> <ul class=md-footer-social> <li class=md-footer-social__li> <a href=http://eepurl.com/dvnr8D class="md-footer-social__link fa fa-envelope-square"> <span class=md-footer-social__desc>Newsletter</span> </a> </li> <li class=md-footer-social__li> <a href=https://twitter.com/DANSKNAW class="md-footer-social__link fa fa-twitter-square"> <span class=md-footer-social__desc>Twitter</span> </a> </li> <li class=md-footer-social__li> <a href=https://www.youtube.com/user/DANSDataArchiving class="md-footer-social__link fa fa-youtube-square"> <span class=md-footer-social__desc>YouTube</span> </a> </li> <li class=md-footer-social__li> <a href=https://www.linkedin.com/company/dans class="md-footer-social__link fa fa-linkedin-square"> <span class=md-footer-social__desc>LinkedIn</span> </a> </li> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.f780ca69.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>