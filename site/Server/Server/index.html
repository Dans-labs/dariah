<!doctype html><html lang=en class=no-js> <head><link href=https://fonts.gstatic.com rel=preconnect crossorigin><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="The technical documentation of the DARIAH Contribution Tool. Design, specs, rationales, patterns, diagrams.
"><link href=https://dans-labs.github.io/dariah/Server/Server/ rel=canonical><meta name=author content="Dirk Roorda"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../icons/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-dans-4.4.1"><title>Server - Tech Doc DARIAH contribution tool</title><link rel=stylesheet href=../../assets/stylesheets/application.27a306a7.css><script src=../../assets/javascripts/modernizr.74668098.js></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|Glegoo:300,400,400i,700|Ubuntu+Mono&display=swap"><style>.body-type,body,input{font-family:"Open Sans",sans-serif}.head-type,h1,h2,h3,h4,h5{font-family:"Glegoo",serif}.code-type,code,kbd,pre{font-family:"Ubuntu Mono",monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#server tabindex=1 class=md-skip> Skip to content </a> <header class="md-header md-dev" data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://www.dariah.eu title=DARIAH class="md-header-nav__button md-logo"> <img src=../../images/dariah.png height=50> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://dans-labs.github.io/dariah/ title="Tech Doc DARIAH contribution tool" class="md-header-nav__button md-logo"> <img src=../../images/inkind_logo.png height=50> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title head-type" data-md-component=title> <span class=md-header-nav__topic> Tech Doc DARIAH contribution tool <span class="md-dev-inline head-type"> still in beta </span> </span> <span class=md-header-nav__topic> Server <span class="md-dev-inline head-type"> still in beta </span> </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/dans-labs/dariah/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Dans-labs/dariah </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. title=Home class="md-tabs__link head-type"> Home </a> </li> <li class=md-tabs__item> <a href=../../About/Codebase/ title=About class="md-tabs__link head-type"> About </a> </li> <li class=md-tabs__item> <a href=../../Functionality/Business/ title=Functionality class="md-tabs__link head-type"> Functionality </a> </li> <li class=md-tabs__item> <a href=../../Legacy/Content/ title=Legacy class="md-tabs__link head-type"> Legacy </a> </li> <li class=md-tabs__item> <a href=../../Concepts/Architecture/ title=Concepts class="md-tabs__link head-type"> Concepts </a> </li> <li class=md-tabs__item> <a href=../Authentication/ title=Server class="md-tabs__link md-tabs__link--active head-type"> Server </a> </li> <li class=md-tabs__item> <a href=../../Client/Components/ title=Client class="md-tabs__link head-type"> Client </a> </li> <li class=md-tabs__item> <a href=../../Technology/Tech/ title=Technology class="md-tabs__link head-type"> Technology </a> </li> <li class=md-tabs__item> <a href=../../Integration/API/ title=Integration class="md-tabs__link head-type"> Integration </a> </li> <li class=md-tabs__item> <a href=../../Maintenance/Deploy/ title=Maintenance class="md-tabs__link head-type"> Maintenance </a> </li> </ul> </div> </nav> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title head-type md-nav__title--site" for=__drawer> <a href=https://dans-labs.github.io/dariah/ title="Tech Doc DARIAH contribution tool" class="md-nav__button md-logo"> <img src=../../images/inkind_logo.png width=48 height=48> </a> Tech Doc DARIAH contribution tool </label> <div class=md-nav__source> <a href=https://github.com/dans-labs/dariah/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Dans-labs/dariah </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class="md-nav__link head-type"> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class="md-nav__link head-type" for=nav-2> About </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-2> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../About/Codebase/ title=Codebase class="md-nav__link head-type"> Codebase </a> </li> <li class=md-nav__item> <a href=../../About/Stats/ title=Stats class="md-nav__link head-type"> Stats </a> </li> <li class=md-nav__item> <a href=../../About/News/ title=News class="md-nav__link head-type"> News </a> </li> <li class=md-nav__item> <a href=../../About/Lessons/ title=Lessons class="md-nav__link head-type"> Lessons </a> </li> <li class=md-nav__item> <a href=../../About/Diagrams/ title=Diagrams class="md-nav__link head-type"> Diagrams </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class="md-nav__link head-type" for=nav-3> Functionality </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-3> Functionality </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Functionality/Business/ title=Business class="md-nav__link head-type"> Business </a> </li> <li class=md-nav__item> <a href=../../Functionality/Tables/ title=Tables class="md-nav__link head-type"> Tables </a> </li> <li class=md-nav__item> <a href=../../Functionality/Workflow/ title=Workflow class="md-nav__link head-type"> Workflow </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class="md-nav__link head-type" for=nav-4> Legacy </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-4> Legacy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Legacy/Content/ title=Content class="md-nav__link head-type"> Content </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class="md-nav__link head-type" for=nav-5> Concepts </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-5> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Concepts/Architecture/ title=Architecture class="md-nav__link head-type"> Architecture </a> </li> <li class=md-nav__item> <a href=../../Concepts/Model/ title=Model class="md-nav__link head-type"> Model </a> </li> <li class=md-nav__item> <a href=../../Concepts/Routing/ title=Routing class="md-nav__link head-type"> Routing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6 checked> <label class="md-nav__link head-type" for=nav-6> Server </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-6> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Authentication/ title=Authentication class="md-nav__link head-type"> Authentication </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active head-type" for=__toc> Server </label> <a href=./ title=Server class="md-nav__link md-nav__link--active head-type"> Server </a> <nav class="md-nav md-nav--secondary"> <label class="md-nav__title head-type" for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#perm title=perm class="md-nav__link head-type"> perm </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#allow-table-action-msgs-controllernone-documentnone-newvaluesnone-mynone-verbosetrue title="allow( table, action, msgs, controller=None, document=None, newValues=None, my=None, verbose=True)" class="md-nav__link head-type"> allow( table, action, msgs, controller=None, document=None, newValues=None, my=None, verbose=True) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#db title=db class="md-nav__link head-type"> db </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validatetable-itemvalues-updatefields title="validate(table, itemValues, updateFields)" class="md-nav__link head-type"> validate(table, itemValues, updateFields) </a> </li> <li class=md-nav__item> <a href=#getlistcontroller-table-rowfilter-titleonly-withvaluelists-withfilters-my title="getList(controller, table, rowFilter, titleOnly, withValueLists, withFilters, my)" class="md-nav__link head-type"> getList(controller, table, rowFilter, titleOnly, withValueLists, withFilters, my) </a> </li> <li class=md-nav__item> <a href=#getitemcontroller-table-ident title="getItem(controller, table, ident)" class="md-nav__link head-type"> getItem(controller, table, ident) </a> </li> <li class=md-nav__item> <a href=#modlistcontroller-table-action title="modList(controller, table, action)" class="md-nav__link head-type"> modList(controller, table, action) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#user title=user class="md-nav__link head-type"> user </a> </li> <li class=md-nav__item> <a href=#auth title=auth class="md-nav__link head-type"> auth </a> </li> <li class=md-nav__item> <a href=#file title=file class="md-nav__link head-type"> file </a> </li> <li class=md-nav__item> <a href=#utils title=utils class="md-nav__link head-type"> utils </a> </li> <li class=md-nav__item> <a href=#workflow title=workflow class="md-nav__link head-type"> workflow </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#getactiveitemsbasiclist title=getActiveItems(basicList) class="md-nav__link head-type"> getActiveItems(basicList) </a> </li> <li class=md-nav__item> <a href=#detailinsertbasiclist-tablenone-masterdocumentnone title="detailInsert(basicList, table=None, masterDocument=None)" class="md-nav__link head-type"> detailInsert(basicList, table=None, masterDocument=None) </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class="md-nav__link head-type" for=nav-7> Client </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-7> Client </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Client/Components/ title=Components class="md-nav__link head-type"> Components </a> </li> <li class=md-nav__item> <a href=../../Client/Dux/ title=Dux class="md-nav__link head-type"> Dux </a> </li> <li class=md-nav__item> <a href=../../Client/Templates/ title=Templates class="md-nav__link head-type"> Templates </a> </li> <li class=md-nav__item> <a href=../../Client/Lib/ title=Lib class="md-nav__link head-type"> Lib </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class="md-nav__link head-type" for=nav-8> Technology </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-8> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Technology/Tech/ title=Tech class="md-nav__link head-type"> Tech </a> </li> <li class=md-nav__item> <a href=../../Technology/ES6/ title=ES6 class="md-nav__link head-type"> ES6 </a> </li> <li class=md-nav__item> <a href=../../Technology/React/ title=React class="md-nav__link head-type"> React </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class="md-nav__link head-type" for=nav-9> Integration </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-9> Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Integration/API/ title=API class="md-nav__link head-type"> API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class="md-nav__link head-type" for=nav-10> Maintenance </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-10> Maintenance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Maintenance/Deploy/ title=Deploy class="md-nav__link head-type"> Deploy </a> </li> <li class=md-nav__item> <a href=../../Maintenance/Tests/ title=Tests class="md-nav__link head-type"> Tests </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class="md-nav__title head-type" for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#perm title=perm class="md-nav__link head-type"> perm </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#allow-table-action-msgs-controllernone-documentnone-newvaluesnone-mynone-verbosetrue title="allow( table, action, msgs, controller=None, document=None, newValues=None, my=None, verbose=True)" class="md-nav__link head-type"> allow( table, action, msgs, controller=None, document=None, newValues=None, my=None, verbose=True) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#db title=db class="md-nav__link head-type"> db </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validatetable-itemvalues-updatefields title="validate(table, itemValues, updateFields)" class="md-nav__link head-type"> validate(table, itemValues, updateFields) </a> </li> <li class=md-nav__item> <a href=#getlistcontroller-table-rowfilter-titleonly-withvaluelists-withfilters-my title="getList(controller, table, rowFilter, titleOnly, withValueLists, withFilters, my)" class="md-nav__link head-type"> getList(controller, table, rowFilter, titleOnly, withValueLists, withFilters, my) </a> </li> <li class=md-nav__item> <a href=#getitemcontroller-table-ident title="getItem(controller, table, ident)" class="md-nav__link head-type"> getItem(controller, table, ident) </a> </li> <li class=md-nav__item> <a href=#modlistcontroller-table-action title="modList(controller, table, action)" class="md-nav__link head-type"> modList(controller, table, action) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#user title=user class="md-nav__link head-type"> user </a> </li> <li class=md-nav__item> <a href=#auth title=auth class="md-nav__link head-type"> auth </a> </li> <li class=md-nav__item> <a href=#file title=file class="md-nav__link head-type"> file </a> </li> <li class=md-nav__item> <a href=#utils title=utils class="md-nav__link head-type"> utils </a> </li> <li class=md-nav__item> <a href=#workflow title=workflow class="md-nav__link head-type"> workflow </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#getactiveitemsbasiclist title=getActiveItems(basicList) class="md-nav__link head-type"> getActiveItems(basicList) </a> </li> <li class=md-nav__item> <a href=#detailinsertbasiclist-tablenone-masterdocumentnone title="detailInsert(basicList, table=None, masterDocument=None)" class="md-nav__link head-type"> detailInsert(basicList, table=None, masterDocument=None) </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/dans-labs/dariah/edit/master/docs/Server/Server.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=server>Server<a class=headerlink href=#server title="Permanent link">&para;</a></h1> <p>Although this app is a single page application with most of the business logic coded at the client side, there are a bunch of things that are handled at the server side.</p> <p>All data access is handled by server side controllers that implement a data api. These controllers are informed by the <a href=../../Concepts/Model/ >data model</a> .</p> <p>When the web server starts, the data model files are read, and converted to python modules with the same base name that encapsulate the information in the YAML files.</p> <p>These modules are then imported by all controllers, so that all data access happens in conformance with the data model and its permissions.</p> <h2 id=perm><a href=https://github.com/Dans-labs/dariah/blob/master/server/controllers/perm.py>perm</a><a class=headerlink href=#perm title="Permanent link">&para;</a></h2> <p>Contains the methods to compute permissions for controllers, tables and fields. Here are the main methods.</p> <h3 id=allow-table-action-msgs-controllernone-documentnone-newvaluesnone-mynone-verbosetrue>allow( table, action, msgs, controller=None, document=None, newValues=None, my=None, verbose=True)<a class=headerlink href=#allow-table-action-msgs-controllernone-documentnone-newvaluesnone-mynone-verbosetrue title="Permanent link">&para;</a></h3> <p>Given table and an action (such as <code>read</code>, <code>update</code>), this method computes whether that action may be performed on behalf of the current web user. If a document is specified, the information in that document will be used to determine whether the document is owned by the user, and in that case the permissions tend to be more liberal. Without a document, permissions are calculated as if the user does not own any document in the table.</p> <p>The result has three parts:</p> <ul> <li><strong>good</strong>: a boolean which tells: yes, allowed, or no: forbidden;</li> <li><strong>rowFilter</strong>, which specifies, in case of a yes, to which rows the action may be applied; it has the shape of a MongoDB selection criterion, but it can also be <code>False</code> (no rows) or <code>True</code> (all rows) or <code>None</code> (irrelevant). </li> <li><strong>fieldSet</strong>, which specifies, in case of yes, which fields in those rows may be acted upon; it is a <code>Set</code>.</li> </ul> <p>If not good, <em>rowFilter</em> and <em>fieldSet</em> will be <code>None</code>.</p> <p>If a document is passed <em>rowFilter</em> will be <code>None</code>, because it is not needed. Only if no document is given, a <em>rowFilter</em> will be computed. If the operation is not permitted on any row, <em>rowFilter</em> becomes <code>False</code>. The reaction to this outcome should be to not perform a database lookup at all.</p> <p>But this is not a permission error, because in this case the list of records for which the operation is allowed is empty. This is different from <em>good</em> is <code>False</code> and <em>rowFilter</em> is <code>None</code>.</p> <p>If the operation is permitted on a selection of rows, <em>rowFilter</em> is returned as a mongodb selection dict is returned. If the operation is permitted on all rows, <em>rowFilter</em> is returned as <code>True</code>.</p> <p>If no fields are permitted, <em>fieldSet</em> is returned as <code>set()</code>. This will still deliver the <code>_id</code> fields, because <code>_id</code> fields are always permitted. If all or part of the fields are permitted, the set of permitted fields is returned.</p> <h2 id=db><a href=https://github.com/Dans-labs/dariah/blob/master/server/controllers/db.py>db</a><a class=headerlink href=#db title="Permanent link">&para;</a></h2> <p>This is the data access module. It uses the <a href=../../Concepts/Model/ >data model</a> to serve any data to any user in such a way that no data is sent from server to client that the current user is not entitled to see.</p> <p>The code in <code>db</code> is generic, it does not contain explicit reference to particular tables and fields. All specifics are derived form the <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/model.yaml>model config file</a> and the table specific files in <a href=https://github.com/Dans-labs/dariah/blob/master/server/models/tables>tables</a> .</p> <p>There are also <em>hooks</em>, where specific behaviour for certain tables can be specified. That behaviour is coded in the <a href=#workflow>workflow module</a> .</p> <p>We describe the main methods here.</p> <h3 id=validatetable-itemvalues-updatefields>validate(table, itemValues, updateFields)<a class=headerlink href=#validatetable-itemvalues-updatefields title="Permanent link">&para;</a></h3> <p>Server validation of the values of a record. <code>itemValues</code> is a dictionary of all field values of the item, and <code>updateFields</code> is the set of fields to be updated.</p> <p>The result consists of a boolean that states whether all values are valid, a dictionary of diagnostic information if there are validation errors, a list of error messages if the validation process itself failed, and a list of new values created in related tables.</p> <h3 id=getlistcontroller-table-rowfilter-titleonly-withvaluelists-withfilters-my>getList(controller, table, rowFilter, titleOnly, withValueLists, withFilters, my)<a class=headerlink href=#getlistcontroller-table-rowfilter-titleonly-withvaluelists-withfilters-my title="Permanent link">&para;</a></h3> <p>A true workhorse, that retrieves the contents of a table, in various circumstances.</p> <p>The <code>controller</code> is the name of the top-level method that called this function.</p> <p><code>table</code> is the name of the table in question.</p> <p><code>rowFilter</code> is a selection on the rows of the table. Possibly, the access levels will restrict the set of returned rows further.</p> <p><code>titleOnly</code> tells whether only the titles or the full data of the records should be fetched. Again: access levels may constrain the set of returned fields further.</p> <p><code>withValueLists</code>: if true and if there are fields whose values reside in value lists, these value lists will be fetched as well.</p> <p><code>withFilters</code>: if true, the filter specifications of the table will also be returned.</p> <p><code>my</code>: if True: only fetches rows that have been created by the current user.</p> <p>If <code>my</code> is a list of fields, these are <em>ourFields</em>. These fields contain user ids, and only records with the current user occurring in one of those fields, will be fetched.</p> <p>Where as <code>my=True</code> is intended to fetch records that are owned or editable by the current user, <code>my=ourFields</code> is intended to fetch records that are relevant to the current user in an other, configurable way.</p> <p>It only works if there is a section <code>ourFields</code> in the data model of <code>table</code>, which lists a number of fields.</p> <h3 id=getitemcontroller-table-ident>getItem(controller, table, ident)<a class=headerlink href=#getitemcontroller-table-ident title="Permanent link">&para;</a></h3> <p>Fetches a single item.</p> <p>The <code>controller</code> is the name of the top-level method that called this function.</p> <p><code>table</code> is the name of the table in question.</p> <p><code>ident</code> is the identifier of the item in question.</p> <p>This function also return for each field whether the current user is entitled to update it. And also whether the current user may delete this record.</p> <p>Finally, the function also indicate whether the user has fetched all allowable fields. This is relevant in a scenario where the user has fetched a list of items (title only) first, and then fetches an individual item. The client application needs to know for each item how much of its field have actually been fetched.</p> <h3 id=modlistcontroller-table-action>modList(controller, table, action)<a class=headerlink href=#modlistcontroller-table-action title="Permanent link">&para;</a></h3> <p>An other workhorse. This function can insert, update and delete a single item. New items are inserted as rows with blank fields. The information to update items is fetched from the request object. The client has sent this material to the server.</p> <p>The <code>controller</code> is the name of the top-level method that called this function.</p> <p><code>table</code> is the name of the table in question.</p> <h2 id=user><a href=https://github.com/Dans-labs/dariah/blob/master/server/controllers/user.py>user</a><a class=headerlink href=#user title="Permanent link">&para;</a></h2> <p>Contains the logic needed to maintain the user table. When new users log in through the DARIAH infrastructure, it collects their <code>eppn</code>, i.e. the names by which they are identified by the authentication systems. It also retrieves to what permission groups users belong.</p> <h2 id=auth><a href=https://github.com/Dans-labs/dariah/blob/master/server/controllers/auth.py>auth</a><a class=headerlink href=#auth title="Permanent link">&para;</a></h2> <p>Contains the methods to authenticate users. Here all the logic about user sessions and session cookies is written down. It builds on the Flask web framework.</p> <h2 id=file><a href=https://github.com/Dans-labs/dariah/blob/master/server/controllers/file.py>file</a><a class=headerlink href=#file title="Permanent link">&para;</a></h2> <p>Contains the methods to get file data from the server. There is a method to serve static files by calling the web framework Flask. And there is a method to read a file and deliver its content as JSON.</p> <h2 id=utils><a href=https://github.com/Dans-labs/dariah/blob/master/server/controllers/utils.py>utils</a><a class=headerlink href=#utils title="Permanent link">&para;</a></h2> <p>Low level stuff.</p> <h2 id=workflow><a href=https://github.com/Dans-labs/dariah/blob/master/server/controllers/workflow.py>workflow</a><a class=headerlink href=#workflow title="Permanent link">&para;</a></h2> <p>Contains workflow specific behaviour, i.e. the specifics of the assessment and review process.</p> <h3 id=getactiveitemsbasiclist>getActiveItems(basicList)<a class=headerlink href=#getactiveitemsbasiclist title="Permanent link">&para;</a></h3> <p>Calculates the active package, and from there the active types and criteria, given the current time. This is the backdrop for any assessment and review action.</p> <p>The parameter <code>basicList</code> is a function that can retrieve documents from the database, in such a way that the access restrictions are respected. It is defined in <a href=#db>db</a> and will be passed from there. So this module does not do its own data access, all data access is still coded in <a href=#db>db</a> .</p> <h3 id=detailinsertbasiclist-tablenone-masterdocumentnone>detailInsert(basicList, table=None, masterDocument=None)<a class=headerlink href=#detailinsertbasiclist-tablenone-masterdocumentnone title="Permanent link">&para;</a></h3> <p>Method invoked by <a href=#db>db</a> , just before an item is inserted. This method has the opportunity to generate extra fields for that record, and to generate extra details in other tables, to be inserted.</p> <p>It needs to deliver a dictionary of insertValues (field=value pairs) and a dictionary of detail records, keyed by detail table name. The values are lists of field=value dictionaries. Before <a href=#db>db</a> will proceed to insert them, the detail records will get the id of the just inserted main record. This will be used as masterId when the details get inserted.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../Authentication/ title=Authentication class="md-flex md-footer-nav__link md-footer-nav__link--prev head-type" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> Authentication </span> </div> </a> <a href=../../Client/Components/ title=Components class="md-flex md-footer-nav__link md-footer-nav__link--next head-type" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> Components </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-disclaimer> The content of this site is produced under responsibility of project <b>Dans-labs/dariah</b> and is subject to change. </div> <div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> customised by <a href=https://github.com/Dans-labs>Dans-labs</a> </div> </div> <div class=md-footer-dans> <div>DANS is an institute of KNAW and NWO</div> <div> <a href=https://dans.knaw.nl/en title="Data Archiving and Networked Services (DANS)"><img class=md-footer-dans__img src=../../assets/images/DANS.gif height=50></a> <a target=_blank href=https://www.knaw.nl/en><img src=../../assets/images/knaw.png height=50></a> <a target=_blank href=https://www.nwo.nl/en><img src=../../assets/images/nwo.png height=50></a> </div> <div><i>Driven by data</i></div> </div> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <style>.md-footer-social__desc{font-family:"Open Sans",sans-serif;-webkit-font-smoothing:auto}</style> <ul class=md-footer-social> <li class=md-footer-social__li> <a href=http://eepurl.com/dvnr8D class="md-footer-social__link fa fa-envelope-square"> <span class=md-footer-social__desc>Newsletter</span> </a> </li> <li class=md-footer-social__li> <a href=https://twitter.com/DANSKNAW class="md-footer-social__link fa fa-twitter-square"> <span class=md-footer-social__desc>Twitter</span> </a> </li> <li class=md-footer-social__li> <a href=https://www.youtube.com/user/DANSDataArchiving class="md-footer-social__link fa fa-youtube-square"> <span class=md-footer-social__desc>YouTube</span> </a> </li> <li class=md-footer-social__li> <a href=https://www.linkedin.com/company/dans class="md-footer-social__link fa fa-linkedin-square"> <span class=md-footer-social__desc>LinkedIn</span> </a> </li> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.f780ca69.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>