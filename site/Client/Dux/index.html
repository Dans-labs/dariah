<!doctype html><html lang=en class=no-js> <head><link href=https://fonts.gstatic.com rel=preconnect crossorigin><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="The technical documentation of the DARIAH Contribution Tool. Design, specs, rationales, patterns, diagrams.
"><link href=https://dans-labs.github.io/dariah/Client/Dux/ rel=canonical><meta name=author content="Dirk Roorda"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../icons/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-dans-4.4.1"><title>Dux - Tech Doc DARIAH contribution tool</title><link rel=stylesheet href=../../assets/stylesheets/application.27a306a7.css><script src=../../assets/javascripts/modernizr.74668098.js></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|Glegoo:300,400,400i,700|Ubuntu+Mono&display=swap"><style>.body-type,body,input{font-family:"Open Sans",sans-serif}.head-type,h1,h2,h3,h4,h5{font-family:"Glegoo",serif}.code-type,code,kbd,pre{font-family:"Ubuntu Mono",monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#dux-appliances tabindex=1 class=md-skip> Skip to content </a> <header class="md-header md-dev" data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://www.dariah.eu title=DARIAH class="md-header-nav__button md-logo"> <img src=../../images/dariah.png height=50> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://dans-labs.github.io/dariah/ title="Tech Doc DARIAH contribution tool" class="md-header-nav__button md-logo"> <img src=../../images/inkind_logo.png height=50> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title head-type" data-md-component=title> <span class=md-header-nav__topic> Tech Doc DARIAH contribution tool <span class="md-dev-inline head-type"> still in beta </span> </span> <span class=md-header-nav__topic> Dux <span class="md-dev-inline head-type"> still in beta </span> </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/dans-labs/dariah/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Dans-labs/dariah </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. title=Home class="md-tabs__link head-type"> Home </a> </li> <li class=md-tabs__item> <a href=../../About/Codebase/ title=About class="md-tabs__link head-type"> About </a> </li> <li class=md-tabs__item> <a href=../../Functionality/Business/ title=Functionality class="md-tabs__link head-type"> Functionality </a> </li> <li class=md-tabs__item> <a href=../../Legacy/Content/ title=Legacy class="md-tabs__link head-type"> Legacy </a> </li> <li class=md-tabs__item> <a href=../../Concepts/Architecture/ title=Concepts class="md-tabs__link head-type"> Concepts </a> </li> <li class=md-tabs__item> <a href=../../Server/Authentication/ title=Server class="md-tabs__link head-type"> Server </a> </li> <li class=md-tabs__item> <a href=../Components/ title=Client class="md-tabs__link md-tabs__link--active head-type"> Client </a> </li> <li class=md-tabs__item> <a href=../../Technology/Tech/ title=Technology class="md-tabs__link head-type"> Technology </a> </li> <li class=md-tabs__item> <a href=../../Integration/API/ title=Integration class="md-tabs__link head-type"> Integration </a> </li> <li class=md-tabs__item> <a href=../../Maintenance/Deploy/ title=Maintenance class="md-tabs__link head-type"> Maintenance </a> </li> </ul> </div> </nav> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title head-type md-nav__title--site" for=__drawer> <a href=https://dans-labs.github.io/dariah/ title="Tech Doc DARIAH contribution tool" class="md-nav__button md-logo"> <img src=../../images/inkind_logo.png width=48 height=48> </a> Tech Doc DARIAH contribution tool </label> <div class=md-nav__source> <a href=https://github.com/dans-labs/dariah/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Dans-labs/dariah </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class="md-nav__link head-type"> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class="md-nav__link head-type" for=nav-2> About </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-2> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../About/Codebase/ title=Codebase class="md-nav__link head-type"> Codebase </a> </li> <li class=md-nav__item> <a href=../../About/Stats/ title=Stats class="md-nav__link head-type"> Stats </a> </li> <li class=md-nav__item> <a href=../../About/News/ title=News class="md-nav__link head-type"> News </a> </li> <li class=md-nav__item> <a href=../../About/Lessons/ title=Lessons class="md-nav__link head-type"> Lessons </a> </li> <li class=md-nav__item> <a href=../../About/Diagrams/ title=Diagrams class="md-nav__link head-type"> Diagrams </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class="md-nav__link head-type" for=nav-3> Functionality </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-3> Functionality </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Functionality/Business/ title=Business class="md-nav__link head-type"> Business </a> </li> <li class=md-nav__item> <a href=../../Functionality/Tables/ title=Tables class="md-nav__link head-type"> Tables </a> </li> <li class=md-nav__item> <a href=../../Functionality/Workflow/ title=Workflow class="md-nav__link head-type"> Workflow </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class="md-nav__link head-type" for=nav-4> Legacy </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-4> Legacy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Legacy/Content/ title=Content class="md-nav__link head-type"> Content </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class="md-nav__link head-type" for=nav-5> Concepts </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-5> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Concepts/Architecture/ title=Architecture class="md-nav__link head-type"> Architecture </a> </li> <li class=md-nav__item> <a href=../../Concepts/Model/ title=Model class="md-nav__link head-type"> Model </a> </li> <li class=md-nav__item> <a href=../../Concepts/Routing/ title=Routing class="md-nav__link head-type"> Routing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class="md-nav__link head-type" for=nav-6> Server </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-6> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Server/Authentication/ title=Authentication class="md-nav__link head-type"> Authentication </a> </li> <li class=md-nav__item> <a href=../../Server/Server/ title=Server class="md-nav__link head-type"> Server </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7 checked> <label class="md-nav__link head-type" for=nav-7> Client </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-7> Client </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Components/ title=Components class="md-nav__link head-type"> Components </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active head-type" for=__toc> Dux </label> <a href=./ title=Dux class="md-nav__link md-nav__link--active head-type"> Dux </a> <nav class="md-nav md-nav--secondary"> <label class="md-nav__title head-type" for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#alter title=alter class="md-nav__link head-type"> alter </a> </li> <li class=md-nav__item> <a href=#docs title=docs class="md-nav__link head-type"> docs </a> </li> <li class=md-nav__item> <a href=#filters title=filters class="md-nav__link head-type"> filters </a> </li> <li class=md-nav__item> <a href=#forms title=forms class="md-nav__link head-type"> forms </a> </li> <li class=md-nav__item> <a href=#grid title=grid class="md-nav__link head-type"> grid </a> </li> <li class=md-nav__item> <a href=#me title=me class="md-nav__link head-type"> me </a> </li> <li class=md-nav__item> <a href=#notes title=notes class="md-nav__link head-type"> notes </a> </li> <li class=md-nav__item> <a href=#roots title=roots class="md-nav__link head-type"> roots </a> </li> <li class=md-nav__item> <a href=#select title=select class="md-nav__link head-type"> select </a> </li> <li class=md-nav__item> <a href=#server title=server class="md-nav__link head-type"> server </a> </li> <li class=md-nav__item> <a href=#settings title=settings class="md-nav__link head-type"> settings </a> </li> <li class=md-nav__item> <a href=#tables title=tables class="md-nav__link head-type"> tables </a> </li> <li class=md-nav__item> <a href=#win title=win class="md-nav__link head-type"> win </a> </li> <li class=md-nav__item> <a href=#workflow title=workflow class="md-nav__link head-type"> workflow </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Templates/ title=Templates class="md-nav__link head-type"> Templates </a> </li> <li class=md-nav__item> <a href=../Lib/ title=Lib class="md-nav__link head-type"> Lib </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class="md-nav__link head-type" for=nav-8> Technology </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-8> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Technology/Tech/ title=Tech class="md-nav__link head-type"> Tech </a> </li> <li class=md-nav__item> <a href=../../Technology/ES6/ title=ES6 class="md-nav__link head-type"> ES6 </a> </li> <li class=md-nav__item> <a href=../../Technology/React/ title=React class="md-nav__link head-type"> React </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class="md-nav__link head-type" for=nav-9> Integration </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-9> Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Integration/API/ title=API class="md-nav__link head-type"> API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class="md-nav__link head-type" for=nav-10> Maintenance </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-10> Maintenance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Maintenance/Deploy/ title=Deploy class="md-nav__link head-type"> Deploy </a> </li> <li class=md-nav__item> <a href=../../Maintenance/Tests/ title=Tests class="md-nav__link head-type"> Tests </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class="md-nav__title head-type" for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#alter title=alter class="md-nav__link head-type"> alter </a> </li> <li class=md-nav__item> <a href=#docs title=docs class="md-nav__link head-type"> docs </a> </li> <li class=md-nav__item> <a href=#filters title=filters class="md-nav__link head-type"> filters </a> </li> <li class=md-nav__item> <a href=#forms title=forms class="md-nav__link head-type"> forms </a> </li> <li class=md-nav__item> <a href=#grid title=grid class="md-nav__link head-type"> grid </a> </li> <li class=md-nav__item> <a href=#me title=me class="md-nav__link head-type"> me </a> </li> <li class=md-nav__item> <a href=#notes title=notes class="md-nav__link head-type"> notes </a> </li> <li class=md-nav__item> <a href=#roots title=roots class="md-nav__link head-type"> roots </a> </li> <li class=md-nav__item> <a href=#select title=select class="md-nav__link head-type"> select </a> </li> <li class=md-nav__item> <a href=#server title=server class="md-nav__link head-type"> server </a> </li> <li class=md-nav__item> <a href=#settings title=settings class="md-nav__link head-type"> settings </a> </li> <li class=md-nav__item> <a href=#tables title=tables class="md-nav__link head-type"> tables </a> </li> <li class=md-nav__item> <a href=#win title=win class="md-nav__link head-type"> win </a> </li> <li class=md-nav__item> <a href=#workflow title=workflow class="md-nav__link head-type"> workflow </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/dans-labs/dariah/edit/master/docs/Client/Dux.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=dux-appliances>Dux (Appliances)<a class=headerlink href=#dux-appliances title="Permanent link">&para;</a></h1> <p>Dux (ducts) are appliances within the app, i.e. sets of components that all work with the same slice of the state A dux is a connector between a slice of the state and the components that work with that slice. As such, it is a piece of plumbing, hidden behind the walls and under the floors.</p> <details class=abstract><summary>Organization</summary><p>A <em>dux</em> is organized as one file that contains its <em>actions</em>, <em>reducer</em>, <em>selectors</em> and <em>helpers</em>;</p> <details class=abstract><summary>reducer</summary><p>Programmed as an object of <em>flows</em>. For each <em>action</em>, there is a flow with the same name, which is a function that produces a new state on the basis of that action.</p> </details> </details> <details class=abstract><summary>Associated components</summary><p>A <em>dux</em> is associated a number of React components that make use of it by importing its <em>actions</em>, <em>selectors</em>, and/or <em>helpers</em>.</p> </details> <details class=caution><summary>Many-many relationship between dux and components</summary><p>However, life is complicated, and the interplay between dux and components is no exception. Sometimes actions will be fired that affect more than one slice of the state.</p> <details class=example><summary>filters, alter</summary><p>For example, in order to set up filters for a table, both the <code>tables</code> slice and the <code>filters</code> slice are needed.</p> <p>And when the user expands a table row into a record form, the <code>alter</code> state is changed to cater for the expand action, and the <code>tables</code> slice is changed by receiving additional data for that record.</p> </details> <p>In Redux, the slices of the state are not sealed off from each other. In the end, there is one and only one reducer, that examines every dispatched action for its <code>type</code> property, and hands it over to a sub-reducer that has "subscribed" to handle actions for that type. It is perfectly possible that multiple sub-reducers will deal with a single action.</p> <details class=example><summary>detail records</summary><p>A good example is when a record is displayed with multiple detail records, displayed as a list of titles. There is a button "Open All" on the interface. When it is pressed, data for all detail records is fetched, and the titles expand into full record views for those details.</p> <p>The way it is implemented, is that pressing "Open All" leads to the dispatch of an action with type <code>fetchItems</code>, and with payload the list of ids of the entities that must be fetched.</p> <p>To this action, the <code>tables</code> sub-reducer reacts by fetching the corresponding entity data from the server, and the <code>alter</code> sub-reducer reacts by expanding the corresponding entity titles into full records.</p> </details> <p>Whenever you are tempted to write complicated, time-sensitive logic to orchestrate what happens at multiple slices of the state, all that is needed is in fact just an extra response of an other sub-reducer.</p> </details> <h2 id=alter><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/alter.js>alter</a><a class=headerlink href=#alter title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>A mechanism for switching between alternative representations of a component, such as: expanded / collapsed, editable / read-only. It is a bit more general than that: you can supply <em>n</em> alternatives and <em>n</em> controls, and let the user cycle through the alternatives by clicking the controls.</p> <p>Components that work with alternatives must collect them in a group. The name of that group is passed as a prop called <code>alterSection</code>. Component that are passed this prop, have access to the state of the alternatives in this group. To get the state information for a single alternative, another key must be supplied, usually called <code>alterTag</code>.</p> <p>The component that displays the alternatives need not be the same component that presents the controls to switch alternatives.</p> </details> <details class=abstract><summary>actions</summary><p>All/ actions below work relative an <code>alterSection</code> and <code>alterTag</code>.</p> <details class=explanation><summary>nextAlt</summary><p>Switch to the next alternative. This action must specify the total number of alternatives and an optional initial value. If there is not yet a state for this instantiation, the initial value will be used to start from.</p> </details> <details class=explanation><summary>setAlt</summary><p>Switch to specified alternative.</p> </details> <details class=explanation><summary>setItems</summary><p>This function is used to switch a bunch of records from an open to a closed state or vice versa.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Increases the index of the alternative by one, cyclically, and puts it under the right keys in the state..</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getAltSection</summary><p>Delivers the numbers of the current alternatives as far as they are registered under the <code>alterSection</code> key in the <code>alter</code> slice of the state.</p> </details> </details> <details class=abstract><summary>helpers</summary><details class=explanation><summary>compileAlternatives</summary><p>A component that wants to work with the alternatives, of a group of components, must call <code>compileAlternatives()</code> with the right parameters.</p> <p>Think of a List component that wants to provide child items with a control to expand themselves. It is more efficient that the List connects to the <code>alter</code> state, than that each item connects to that state individually.</p> <p>This function is a factory function that, given an <code>alterTag</code>, delivers an object with functions for getting and setting the alternatives of that particular instance.</p> </details> </details> <details class=caution><summary>all alternatives together</summary><p>It is tempting to make one <code>alterSection</code> for all components in the app that need alternatives. The flip side of doing so is that all those components will be triggered for re-render whenever any single one of them switches alternatives. That is why we offer the possibility of grouping related components under the same <code>alterSection</code> and be shielded from updates in the components that belong to other <code>alterSections</code>.</p> </details> <h2 id=docs><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/docs.js>docs</a><a class=headerlink href=#docs title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Manages Markdown documents. Fetches raw source from the server and stores it into the state, under a key, which is the path information of the document. The <a href=../Components/#docmd>DocMd</a> provides a widget for such documents.</p> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>fetchDoc</summary><p>Fetches a document from the server asynchronously.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Stores the fetched raw document source into the state.</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getDoc</summary><p>Retrieves the stored data for the specified document.</p> </details> </details> <details class=abstract><summary>helpers</summary><details class=explanation><summary>needDoc</summary><p>Check whether a component contains the data for its document.</p> </details> <details class=explanation><summary>changedDoc</summary><p>Check whether a component has new props in such a way that a new document should be fetched.</p> </details> </details> <h2 id=filters><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/filters.js>filters</a><a class=headerlink href=#filters title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Supports the display of filtered lists, where there is a bunch of filters and a list with items filtered by those.</p> <p><img alt=diag src=../../design/design.002.png></p> <p>Lists and filters form a complex system of components, involving</p> <ul> <li>fetching list data from the server,</li> <li>fetching filter specifications</li> <li>fetching the metadata that is used by the filtering</li> <li>handling the user interactions with the filters</li> <li>supporting special effects such as a map of European countries with markers having a radius indicative of the number of filtered items by that country.</li> </ul> <details class=note><summary>multiple slices</summary><p>This dux not only needs data from the <code>filters</code> slice, but also from the <code>tables</code> slice!</p> </details> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>changeFulltext</summary><p>Responds to a change in the search text in a <a href=../Components/#fulltext>Fulltext</a> search widget.</p> </details> <details class=explanation><summary>changeFacet</summary><p>Responds to a click in the checkbox of a facet <a href=../Components/#facet>Facet</a> .</p> </details> <details class=explanation><summary>changeFacetAll</summary><p>Responds to a click to (de)select all facets of a field.</p> </details> <details class=explanation><summary>initFiltering</summary><p>Initializes filtering for a table. This action also looks at the tables slice of the state, which is managed by <a href=#tables>tables</a> .</p> <p>The actual work is done by a memoized helper function <code>compileFieldIds()</code> below.</p> <p>On the basis of this, initial settings of facet filters can be made. This is done by the helper function <code>initFilterSettings()</code> below and these settings are to be added to the <code>filters</code> slice of the state under the key <code>table</code> and then under a key <code>filterTag</code>. In this way you can set up various kinds of filtering for the same table.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Transforms the state in response to dispatched actions, notably the <code>filters</code> slice and within that a sliced keyed by <code>table</code>.</p> </details> <details class=abstract><summary>selectors</summary><details class=abstract><summary>Abstract</summary><p>Filter information is being translated from the state to props that can be consumed by components.</p> </details> <details class=explanation><summary>getFilters</summary><p>Reads the current settings of a filter and injects it as <code>filters</code> into the props of the receiving components, which are typically the filter widgets that receive user interaction: <a href=../Components/#fulltext>Fulltext</a> <a href=../Components/#facet>Facet</a> , and also <a href=../Components/#checkboxi>CheckboxI</a> , <a href=../Components/#eumap>EUMap</a> .</p> </details> </details> <details class=abstract><summary>helpers</summary><details class=explanation><summary>compileValues</summary><p>For every field that is chosen for faceted browsing, the list of values will be compiled.</p> <p>The result is used by <a href=../Components/#byvalue>ByValue</a> . This component is responsible for all the facets of a field.</p> <details class=note><summary>memoization</summary><p>It is useful to store the results of this compilation, but where? We do not store it in the state, because it is derived data, and we adhere to the principle that the state is a <a href=http://redux.js.org/docs/recipes/reducers/NormalizingStateShape.html>normalized single source of truth</a> . Selectors are invoked upon each rendering, but in this case we do not want to redo the compilation all the time. The solution is to use a <a href=http://redux.js.org/docs/recipes/ComputingDerivedData.html>memoized function</a> . I have created my own <a href=../Lib/#memo>memoizer</a> .</p> </details> </details> <details class=explanation><summary>computeFiltering</summary><p>Applies the filters, according to the current filter settings. Applying means: determine the subset of filtered items (<code>filteredData</code>), and provide statistics for the facets.</p> <p>Every faceted field displays as total the amount of items filtered by all <em>other</em> filters (<code>filteredAmountOthers</code>). For each of its facets, it displays how many items of this relative total correspond to that facet (<code>amounts</code>).</p> <p>So this function delivers exactly that: <code>filteredData</code>, <code>filteredAmountOthers</code>, <code>amounts</code>.</p> <p>It is also a costly function, but it does need to be invoked upon each rendering caused by a click or a key press.</p> </details> <details class=explanation><summary>makeTag</summary><p>Makes a <code>filterTag</code>, depending on the situation of the List of items that needs the filtering. The most fundamental issue is: is the list showing all items in the table, or my items only, or is it a list of detail records of some master record in an other table?</p> </details> <details class=explanation><summary>testAllChecks</summary><p>Looks if all facets are checked, or all unchecked, of none of both. Used to steer the <em>collective</em> checkbox that governs all facets.</p> </details> </details> <h2 id=forms><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/forms.js>forms</a><a class=headerlink href=#forms title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>The <code>forms</code> slice of the state is under control of the <a href=https://redux-form.com>Redux-Form</a> module. It contains all current form data of components where the user is interacting with forms.</p> <p>Some other components might want to know whether a component is engaged in data entry or not, without fully connecting to all form state properties of redux-form.</p> <p>This dux gives that information and that information only.</p> </details> <details class=abstract><summary>reducer</summary><p>No reducer, because <a href=https://redux-form.com>Redux-Form</a> has its own reducer and we include it in our overall reducer.</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getForms</summary><p>Returns the set of keys of the <code>forms</code> slice of the state. It calls a memoized function to turn the keys into a set. So, if the set of keys is asked repeatedly without having been changed, exactly the same set object is being returned.</p> </details> </details> <h2 id=grid><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/grid.js>grid</a><a class=headerlink href=#grid title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>This dux support grid views of tables, by managing sorting information of the grid columns. Every grid table must identify itself with a <code>gridTag</code> and its data resides on the <code>grid</code> slice of the state under that tag.</p> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>resetSort</summary><p>Removes all sorting information under a <code>gridTag</code>.</p> </details> <details class=explanation><summary>addColumn</summary><p>Adds a sorting column. Grids can be sorted by multiple columns.</p> </details> <details class=explanation><summary>delColumn</summary><p>Deletes a sorting column.</p> </details> <details class=explanation><summary>turnColumn</summary><p>Toggles the sort method between ascending and descending for a specified column.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Applies the state changes, defined by the actions, to the <code>grid</code> slice, under the key <code>gridTag</code>.</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getGrid</summary><p>Returns the <code>grid</code> slice of the state.</p> </details> </details> <details class=abstract><summary>helpers</summary><details class=explanation><summary>compileSortedData</summary><p>This function actually applies a given sort order to a list of ids of items from a table.</p> </details> </details> <h2 id=me><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/me.js>me</a><a class=headerlink href=#me title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Powers the login widget, top right on the screen, realized by the component <a href=../Components/#login>Login</a> .</p> <p>The login procedure caters for shibboleth logins. Upon successful login, the server sends information about the currently logged in user to the client.</p> <p>The main task of Login is to fetch the current authentication status: is there an authenticated user, and if so, what is his/her name?</p> <details class=note><summary>How the client knows the user name</summary><p>Because of the federated login, the username and password are not entered in any form in this app. So the client does not know who the user is, except by asking the server. The current user can be retrieved by <code>/api/db/who/ami</code>.</p> </details> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>fetchMe</summary><p>Fetches data about <em>me</em>, the logged in user. It is actually handled by the helper <a href=../Lib/#server>server</a> .</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Transforms the state in response to dispatched ticket, notably the <code>me</code> slice. It just contains the known attributes of a single user, the one that is logged in.</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getMe</summary><p>Plainly hand over the attributes of the currently logged in user. At the moment only the <a href=../Components/#login>Login</a> component is interested in it.</p> </details> </details> <h2 id=notes><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/notes.js>notes</a><a class=headerlink href=#notes title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Powers the notification widget, top right on the screen, realized by the component <a href=../Components/#notification>Notification</a> .</p> <p>A notification has a <em>kind</em> and a <em>text</em>. The kind is one of <code>error</code>, <code>warning</code>, <code>special</code>, <code>info</code>. All non-info messages are considered important.</p> <p>Normally, the notification panel is hidden, but it can be called up by clicking on the progress circle in the top-right of the screen. The panel also shows up if there is a new important message, and it will scroll to the last important one.</p> <p>The user can click away the panel and hide the messages.</p> <p><img alt=diag src=../../design/design.005.png></p> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>notify</summary><p>Issues its payload, which consists of an array of messages, as notifications.</p> </details> <details class=explanation><summary>clear</summary><p>Clears the existing list of notifications.</p> </details> <details class=explanation><summary>display</summary><p>Turns the visibility of notification panel on or off.</p> <p>Other components can issue notifications easily, either by importing these actions, or by dispatching the right actions themselves. The helper function <a href=Lib#.mdserver>accessData</a> can issue notifications. These notifications are given the type <code>async</code> and convey a status <code>pending</code>, <code>success</code>, or <code>error</code>.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Transforms the state in response to dispatched ticket, notably the <code>notes</code> slice. The state maintains a counter <code>busy</code>, which is the number of currently asynchronously pending operations. A notification widget can show a progress spinner if <code>busy &gt; 0</code>.</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getNotes</summary><p>The notification widget gets the notifications from the state, including <code>busy</code> and <code>show</code>, the latter indicating whether the notification panel should be hidden or not. For the convenience of the <a href=../Components/#notification>Notification</a> component, the index of the last important notification message is also computed, and its kind.</p> </details> </details> <h2 id=roots><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/roots.js>roots</a><a class=headerlink href=#roots title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Top level management of the state: initialization and combination of all the other dux.</p> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>configureStore</summary><p><code>Root</code> does not have proper actions of its own. But it does set up the store, and passes it on to the <a href=../Components/#main>main</a> component.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Combines all slices of the state and combines all reducers that work their own slice of the state into the <em>root reducer</em>, that operates on the whole state.</p> </details> <h2 id=select><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/select.js>select</a><a class=headerlink href=#select title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Manages the UI-state of the <a href=../Components/#relselect>RelSelect</a> component. Every <em>RelSelect</em> instance must be identified by a tag, so that the states of the select controls do not get confused. The most obvious choice for a tag value is a composition of the table name, the entity id, and the field name.</p> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>setSearch</summary><p>When a user types something in the search input field associated with the select control, the search string is sent to the state.</p> </details> <details class=explanation><summary>setPopUp</summary><p>Parts of the interface of the select widget will pop up after a user action, or disappear after an other user action. This action sets the <em>popped up state</em> categorically to <em>true</em> or <em>false</em>, depending on a parameter.</p> </details> <details class=explanation><summary>togglePopUp</summary><p>Toggles the popped up state of the relevant part of the widget.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Straightforward merge of the payload of pop up actions and search string updates into the state.</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getSelect</summary><p>Retrieves all state information of a <em>specific</em> select control, i.e. an instance identified by a tag.</p> </details> </details> <details class=abstract><summary>helpers</summary><details class=explanation><summary>compileOptions</summary><p>Initializes the state for a specific select control. This is an initialization <em>per tag</em>.</p> </details> </details> <h2 id=server><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/server.js>server</a><a class=headerlink href=#server title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Here all interaction with the server is managed. All activity that involves waiting for a server, will eventually reach out to actions here. The actions below only are concerned with requesting a server response, waiting for it, and reporting success or failure.</p> <p>Before a request is made, it is checked whether that request has been submitted before and is still pending. In that case, the <em>request counter</em> will be increased, and no new request will be made.</p> <ul> <li>request counters that are non-zero correspond to requests that are either pending, or have ended in failure;</li> <li>pending requests have positive request counters, the number represents the number of requests the app has tried to make so far (only 1 request will be issued effectively);</li> <li>successful request have their request counter set to 0 again.</li> </ul> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>accessData</summary><p>Asynchronous action to fetch data from the server, and also to send data to it.</p> <p>A <code>task</code> object specifies what to fetch, and can contain data to send to the server.</p> <p>It can be used for database queries or file content. During the stages of a request, <a href=./#notes>notify</a> actions will be dispatched.</p> </details> <details class=explanation><summary>progress</summary><p>This action represents the situation that a request is offered multiple times before the first one has been completed. The request will not be made, but the request counter will be increased.</p> </details> <details class=explanation><summary>ask</summary><p>Just before a request is made, this action sets the request counter to 1.</p> </details> <details class=explanation><summary>err</summary><p>When a request returns failure, the request counter is set to -1.</p> </details> <details class=explanation><summary>succeed</summary><p>When a request returns success, the request counter is set to 0.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Manages the request counter and puts it under a key under the <code>server</code> slice of the state. The key is identical to the <code>path</code> of the request (the URL that is fired to the server).</p> </details> <details class=note><summary>triggering of <code>notes</code> reducer</summary><p>All actions except <code>accessData</code> are also picked up by the <a href=#notes>notes</a> reducer, where they result in notifications.</p> </details> <h2 id=settings><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/settings.js>settings</a><a class=headerlink href=#settings title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Cross cutting settings for the app are defined here. The <code>settings</code> slice of the state is just a store of keys and values.</p> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>set</summary><p>Adds a key value pair.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Straightforward reducer.</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getSettings</summary><p>Returns the <code>settings</code> slice of the state.</p> </details> </details> <h2 id=tables><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/tables.js>tables</a><a class=headerlink href=#tables title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Manages database data from the server. It keeps a normalized copy of the data. When different components fetch the bits and pieces they need, it all lands here, properly organized. This reduces the amount of fetching that is needed, and it improves consistency, because all data consuming components look at the same data.</p> <p>Principal data consuming components are <a href=../Components/#listcontainer>ListContainer</a> and <a href=../Components/#itemmy>Items</a> .</p> <details class=note><summary>filters</summary><p>In order to do the job properly, a fair amount of metadata about tables and fields is also fetched and stored. In particular, tables specify which filters can be used on which fields. This filter setup is not hard-wired into the client app, but comes from the server, where it is configured in the <a href=../../Concepts/Model/ >data model</a> .</p> </details> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>fetchTable</summary><p>Fetches a complete table, but only the title fields and the fields needed for filtering.</p> </details> <details class=explanation><summary>fetchTables</summary><p>Fetches a list of tables by successively calling <code>fetchTable</code>.</p> </details> <details class=explanation><summary>fetchItem</summary><p>Fetches a single rows from a table, all fields. The server decides which fields I am allowed to retrieve.</p> <p>If fields refer to other tables for their values, the above actions will fetch these tables as well.</p> </details> <details class=explanation><summary>fetchItems</summary><p>Fetches a selection of rows from a table, all fields. The selection is given by a list of <code>_id</code>s to fetch. The server decides which fields may be retrieved.</p> </details> <details class=explanation><summary>modItem</summary><p>Sends a request to update an item to the server, and merges the answer (the updated values) into the state.</p> </details> <details class=explanation><summary>insertItem</summary><p>Sends a request to insert an item to the server, and merges the answer (the inserted item) into the state.</p> </details> <details class=explanation><summary>delItem</summary><p>Sends a request to delete an item to the server, and updates the state to reflect the deletion of that item.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>The actions above potentially receive overlapping data. The reducer takes care that all gets sorted out, and that every bit ends up in its proper place.</p> <details class=abstract open=open><summary>entities</summary><p>A table is stored under its name as key. The table information is an object of entities (rows), keyed by their database id. For each id there is an object containing the field values, an object that contains the workflow information, and an object that contains the permissions for that record.</p> <p>The entities themselves have a <code>values</code> object, with all the field values, keyed by field name. Next to the values there is an attribute <code>complete</code> that tells whether all fields for this entity have been fetched, or only the core fields.</p> </details> <details class=abstract><summary>order</summary><p>Array of ids that specifies the order.</p> </details> <details class=abstract><summary>my</summary><p>If only <em>my</em> rows are being retrieved, this array contains the ids of the retrieved entities in the right order.</p> </details> <details class=abstract><summary>fields</summary><p>The fields of a table.</p> </details> <details class=abstract><summary>fieldOrder</summary><p>The display order of the fields.</p> </details> <details class=abstract><summary>fieldSpecs</summary><p>The specifications of a field: data type, multiplicity, related table, permissions (table wide).</p> </details> <details class=abstract><summary>details</summary><p>An array of objects that describe the tables where the detail records of the main records are.</p> </details> <details class=abstract><summary>detailOrder</summary><p>The display order of the lists of detail records.</p> </details> <details class=abstract><summary>complete</summary><p>Whether the table has been retireved complete, or only the titles of the records.</p> </details> <details class=abstract><summary>filterList</summary><p>An array of filters that are in force.</p> </details> <details class=abstract><summary>valueLists</summary><p>An array of lists of values that this table refers to.</p> </details> <details class=example><summary>my items</summary><p>As an example, consider the scenario that first the complete list of items is fetched, then the <code>my</code> items. The question is: after fetching the <code>my</code> items, will the full table that has been fetched before, be disturbed? The answer is of course no. Because the reducer merges the <code>my</code> entities with the existing entities. So the non-<code>my</code> entities are untouched. But what about <code>order</code>? Well, when reducing a <code>my-fetch</code> action, there is no incoming <code>order</code> array but a <code>my</code> array instead, and the <code>order</code> that already exists on the state is not touched.</p> </details> <details class=example><summary>single item and then full list</summary><p>As a second example, consider the scenario where a single item is fetched first, with all its fields, and then the full list of items, but with only title fields. The question is: will the previously fetched item loose its extra fields? The answer is of course no. Because the reducer merges the new entities' values with existing entities' values.</p> </details> <details class=note><summary>the art of merging</summary><p>Of all dux, this is the best example of what proper <em>reducing</em> is and what it achieves. It might look hard to take care of this merging, under the constraint that only those branches of the state should be touched that are actually updated.</p> <p>But the <a href=https://lodash.com/docs/#mergewith>lodash mergeWith</a> makes this a breeze.</p> <p>Unfortunately, this library does not always leave unchanged values untouched, which results in unnecessary re-renderings of components.</p> <p>The best solution turned out to be <a href=https://github.com/kolodny/immutability-helper>Immutability-Helper</a> .</p> <p>If you want to dive deeper into this issue, see the <a href=../../Maintenance/Tests/#merge>tests about merging</a> , which includes tests that makes this issue crystal clear.</p> <p>The methods of the Immutability-Helper have a syntax inspired by the MongoDB commands, which is a nice reduction of cognitive load, since we use MongoDB at the server side.</p> <p>Have a look again at the <a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/tables.js>reducer source code</a> and see how straightforward it is to code one of the most tricky reducers in this app.</p> <p>This reducer actively covered by <a href=../../Maintenance/Tests/#tablesreducer>tests</a> . Have a look at them to get more feeling of how table actions cause state transitions.</p> </details> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getTables</summary><p>Return the whole <code>tables</code> slice of the state.</p> </details> </details> <details class=abstract><summary>helpers</summary><details class=explanation><summary>entityHead</summary><p>Computes the title for an item, based on the <a href=../../Concepts/Model/ >data model</a> or on specialized functions, defined here. See also <a href=#repr>repr</a> .</p> </details> <details class=explanation><summary>needTable</summary><p>Checks if sufficient <code>table</code> data is available in the state.</p> </details> <details class=explanation><summary>needTables</summary><p>Checks a list of table names to see if sufficient data is available in the state.</p> </details> <details class=explanation><summary>needValues</summary><p>Checks a single entity in a single table to see if it contains values for all fields.</p> </details> <details class=explanation><summary>listValues</summary><p>Gives the list of all values of a specified field in a table.</p> </details> <details class=explanation><summary>presentUser</summary><p>Presents a user, by means of name, email address, and/or <code>eppn</code>, depending on what information is available, which also depends on what information may be shared with the currently logged in user.</p> </details> <details class=explanation><summary>changedItem</summary><p>Checks if properties have changed in such a few that new data should be fetched.</p> </details> <details class=explanation><summary>headEntity</summary><p>The head line of a record, based on its title field and/or other data. For some specific tables custom logic is used.</p> </details> <details class=explanation><summary>repr</summary><p>Makes a streamlined string representation out of a field value. It looks up ids in related value list tables. For some tables, special representation functions will be invoked. (users, countries, etc.).</p> </details> <details class=explanation><summary>toDb</summary><p>Dispatches an item modification action to the store.</p> </details> <details class=explanation><summary>handleOpenAll</summary><p>When a user clicks on an <em>Open All</em> button, this function is invoked to fetch the corresponding records (if needed).</p> </details> <details class=explanation><summary>handleCloseAll</summary><p>When a user clicks on an <em>Close All</em> button, this function is invoked to collapse the corresponding records and remove the <code>_id</code>s of the previously open records from the URL, using <a href=https://github.com/reactjs/react-router-tutorial/tree/master/lessons/10-clean-urls>browserHistory</a> .</p> </details> </details> <h2 id=win><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/win.js>win</a><a class=headerlink href=#win title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>Reacts to window resizing by the user. It will deliver the new window size after resizing. Useful for components that care about the window size, such as <a href=../Components/#app>App</a> .</p> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>changeWinDim</summary><p>Responds to window resizing, as set up in <a href=../Components/#window>Window.md</a> . It is just a matter of storing the <code>height</code> and the <code>width</code> of the window into the state. Note that the event emitter in <a href=../Components/#window>Window.md</a> is being throttled, so that it does not run too frequently during the actual resizing.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>Transforms the <code>win</code> slice of the state in response to resize events.</p> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getWinDim</summary><p>Returns the <code>win</code> slice of the state, which is just the current width and height of the browser window.</p> </details> </details> <h2 id=workflow><a href=https://github.com/Dans-labs/dariah/blob/master/client/src/js/app/dux/workflow.js>workflow</a><a class=headerlink href=#workflow title="Permanent link">&para;</a></h2> <details class=explanation open=open><summary>Explanation</summary><p>A lot of the logic of showing lists, items, related items and fields is purely generic and driven by the <a href=../../Concepts/Model/ >data model</a> .</p> <p>But there is considerably more to an app than this kind of generic logic. The <code>workflow</code> dux is the entry point for additional, non-trivial business logic.</p> <p>It is still in development.</p> <details class=abstract><summary>Active items</summary><p>The <code>package</code> table determines a lot about the assessment process. It has records with a specified startDate end endDate. The packages that have started and are not yet passed there endDate are the <em>active</em> packages. Normally there will be exactly one package.</p> <p>From the active package derive a number of other active concepts:</p> <ul> <li>the contribution types listed in the <code>typeContribution</code> field of the active package are the <em>active types</em></li> <li>the criteria that are details of the active package are <em>active criteria</em>.</li> </ul> <p>The generic List and Item components can be made sensitive to this notion of activity. Active items can be formatted specially, and likewise the non-active items, which can also be disabled in some contexts.</p> <p>The way (in)active items are displayed is controlled by the <a href=../../Concepts/Model/ >data model</a> . See for example the field <code>typeContribution</code> in the tables <code>package</code> and <code>criteria</code>.</p> </details> </details> <details class=abstract><summary>actions</summary><details class=explanation><summary>fetchWorkflow</summary><p>Fetch the info about the workflow information from the server, in particular the reset history since the last startup of the web server.</p> </details> <details class=explanation><summary>resetWorkflow</summary><p>Fetch the same information as <code>fetchWorkflow</code> does, but add <code>?reset=true</code> to the URL that is used to query this information from the server. This will instruct the server to perform a workflow reset.</p> </details> </details> <details class=abstract><summary>reducer</summary><p>The reducer is simple, it only has to perform one action: put incoming workflow data unto the state. No sophisticated merging is needed, because this workflow meta information is only needed for one component, <a href=../Components/#workflowinfo>WorkflowInfo</a> , which is meant for sysadmins only.</p> <details class=note><summary>uses tables reducer</summary><p>The workflow data moves from server to client on the shoulders of the <a href=./#tables>tables</a> reducer.</p> </details> </details> <details class=abstract><summary>selectors</summary><details class=explanation><summary>getWorkflow</summary><p>Returns the <code>workflow</code> slice of the state.</p> </details> </details> <details class=abstract><summary>helpers</summary><details class=explanation><summary>compileActiveItems</summary><p>Computes the active packages, types and criteria and deliver them in an object, keyed by kind of item and containing an array of active item MongoDB ids for that kind.</p> </details> <details class=explanation><summary>decisions</summary><p>Most of the contents of the <code>decision</code> table, in the form of objects by which you can find various user-facing strings associated with the three possible review decisions: <code>accept</code>, <code>revise</code>, and <code>reject</code>.</p> </details> <details class=explanation><summary>finalDecision</summary><p>From workflow attributes that contain reviewers and reviews respectively, find out whether there has been a final decision by reviewer 2, and if so, what it was.</p> </details> <details class=explanation><summary>getItem</summary><p>Peels out items of data from a workflow attribute that has fetched arrays of data from other records.</p> </details> <details class=explanation><summary>isReviewerType</summary><p>Computes whether a given author is the first or second reviewer.</p> </details> <details class=explanation><summary>loadExtra</summary><p>This is a configuration object that specifies which extra tables should be fetched from the server along with particular other tables. For example, the app can only perform its business logic on contributions, if the tables <code>package</code>, <code>criteria</code>, <code>typeContribution</code>, and <code>decision</code> are all present on the state.</p> </details> <details class=explanation><summary>processStatus</summary><p>Produce a string that contains the current assessment status and review status of an assessment. This function can be called from a contribution, an assessment and a review. So for all these kinds of record we can produce a short overview of the state they have reached in the assessment / review process.</p> <p>The outcome has a bit that reveals the assessment status and a bit about the review status.</p> <p>When it is run on behalf of a user with marginal rights, it delivers either the empty string, or the outcome of the final review, but only if there has been a positive outcome.</p> <p>For users with more rights:</p> <ul> <li><strong>assessment status:</strong><ul> <li><code>▶</code> if the assessment has been (re)submitted;</li> <li><code>✍</code> otherwise;</li> <li>the assessment score</li> </ul> </li> <li><strong>review status:</strong><ul> <li>empty string if there review has not reached a final decision;</li> <li><code>✔</code> on <code>accept</code>;</li> <li><code>✋</code> on <code>revise</code>;</li> <li><code>✘</code> on <code>reject</code>.</li> </ul> </li> </ul> </details> <details class=explanation><summary>reviewerRole</summary><p>Object that maps the acronyms <code>E</code> and <code>F</code> to appropriate labels designating first and second reviewer.</p> </details> </details> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../Components/ title=Components class="md-flex md-footer-nav__link md-footer-nav__link--prev head-type" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> Components </span> </div> </a> <a href=../Templates/ title=Templates class="md-flex md-footer-nav__link md-footer-nav__link--next head-type" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> Templates </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-disclaimer> The content of this site is produced under responsibility of project <b>Dans-labs/dariah</b> and is subject to change. </div> <div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> customised by <a href=https://github.com/Dans-labs>Dans-labs</a> </div> </div> <div class=md-footer-dans> <div>DANS is an institute of KNAW and NWO</div> <div> <a href=https://dans.knaw.nl/en title="Data Archiving and Networked Services (DANS)"><img class=md-footer-dans__img src=../../assets/images/DANS.gif height=50></a> <a target=_blank href=https://www.knaw.nl/en><img src=../../assets/images/knaw.png height=50></a> <a target=_blank href=https://www.nwo.nl/en><img src=../../assets/images/nwo.png height=50></a> </div> <div><i>Driven by data</i></div> </div> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <style>.md-footer-social__desc{font-family:"Open Sans",sans-serif;-webkit-font-smoothing:auto}</style> <ul class=md-footer-social> <li class=md-footer-social__li> <a href=http://eepurl.com/dvnr8D class="md-footer-social__link fa fa-envelope-square"> <span class=md-footer-social__desc>Newsletter</span> </a> </li> <li class=md-footer-social__li> <a href=https://twitter.com/DANSKNAW class="md-footer-social__link fa fa-twitter-square"> <span class=md-footer-social__desc>Twitter</span> </a> </li> <li class=md-footer-social__li> <a href=https://www.youtube.com/user/DANSDataArchiving class="md-footer-social__link fa fa-youtube-square"> <span class=md-footer-social__desc>YouTube</span> </a> </li> <li class=md-footer-social__li> <a href=https://www.linkedin.com/company/dans class="md-footer-social__link fa fa-linkedin-square"> <span class=md-footer-social__desc>LinkedIn</span> </a> </li> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.f780ca69.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>