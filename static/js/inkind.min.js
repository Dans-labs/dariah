function Component(dst,name,scomps,fetch,specific,page){this.dst=dst;this.name=name;this.scomps=scomps;this.fetch=fetch;this.page=page;this.specific=specific;};Component.prototype={_fetch:function(sc){var that=this;if(this.fetch){this.msg[sc].msg(`fetching data ...`);$.post(this._fetch_url[sc],{},function(json){that.msg[sc].clear();json.msgs.forEach(function(m){that.msg[sc].msg(m);});if(json.good){that.data[sc]=json.data;that.relvals[sc]=json.relvals;that.wire(sc);}},`json`);}else{this.wire(sc);}},_work:function(sc){this.delg.work(sc);this.page.work(this.name,sc);},weld:function(){this._dst={};this._loaded={};this.msg={};this.container={};this.state=this.page.state;this.data={};this.relvals={};this._fetch_url={};for(var sc in this.scomps){this._loaded[sc]=false;if(this.fetch){this._fetch_url[sc]=url_tpl.replace(/_c_/,`data`).replace(/_f_/,`${this.name}_${sc}`)+`.json`;}}this.delg=new this.specific(this);if(this.dst in this.page.compindex){var dstcontainer=this.page.compindex[this.dst].container;for(var sc in this.scomps){this._dst[sc]=dstcontainer[sc];}}else{var dst=$(`#${this.dst}`);for(var sc in this.scomps){this._dst[sc]=dst;}}for(var sc in this.scomps){this.container[sc]=$(`#${this.name}_${sc}`);if(this.container[sc].length==0){var dst=this._dst[sc];dst.append(`<div id="msg_${this.name}_${sc}"></div>`);dst.append(`<div id="${this.name}_${sc}"></div>`);this.container[sc]=$(`#${this.name}_${sc}`);}this.msg[sc]=new Msg(`msg_${this.name}_${sc}`);this._loaded[sc]=false;this.delg.weld(sc);}},wire:function(sc){if(!this._loaded[sc]){this._loaded[sc]=true;this.delg.wire(sc);}this._work(sc);},work:function(sc){var scomps={};if(sc==undefined){scomps=this.scomps;}else{scomps[sc]=1;}for(var s in scomps){if(this.delg.show(s)){this.container[s].show();if(!this._loaded[s]){this._fetch(s);}else{this._work(s);}}else{this.container[s].hide();this._work(s);}}},};function Control(comp){this.comp=comp;this.widget={};this.ctl={};};Control.prototype={_html:function(sc){this.comp.container[sc].html(`<a class="ctrl radio" href="#">${this.comp.state.showstate('list', sc, 'sg')}</a> `);},_dressup:function(sc){var that=this;this.ctl[sc].click(function(e){e.preventDefault();that.comp.state.setstate(`list`,sc);})},_is_active:function(sc){return this.comp.state.getstate(`list`)==sc;},show:function(sc){return true;},weld:function(sc){this._html(sc);this.widget[sc]=this.comp.container[sc];this.ctl[sc]=this.comp.container[sc].find(`a`);},wire:function(sc){this._dressup(sc);},work:function(sc){if(this._is_active(sc)){this.ctl[sc].addClass(`ison`);this.widget[sc].addClass(`isonn`);}else{this.ctl[sc].removeClass(`ison`);this.widget[sc].removeClass(`isonn`);}}};function CType(comp){this.comp=comp;this.name=`ctype`;this.facet=this.comp.page.getcomp(`facet`).delg;this.enabled={contrib:1};this.fltd={};this._data={};this._relvals={};this._list={};this._allc={};this._sts={};this.tstate={};this.types={};this.type={};this.type_on={};this.type_off={};};CType.prototype={_html:function(sc){var cols=2;var h=`<div><p class="dctrl">By type</p>`;h +=`<p class="all"><span ti="_all" class="stats"></span> <a id="t_all_${sc}" href="#" class="ctrls">all types</a></p>
<table class="clist" id="list-ctype_${sc}"><tr>`;for(var i in this.types[sc]){if((i % cols==0)&&(i > 0)&&(i < this.types[sc].length)){h +=`</tr><tr>`;}var ti=this.types[sc][i];var tv=this.type[sc][ti];h +=`<td><span ti="${ti}" class="stats"></span></td><td><a ti="${ti}" href="#" class="ctrls">${tv}</a></td>`;}h +=`</tr></table></div>`;this.comp.container[sc].html(h);},_dressup:function(sc){var that=this;this._list[sc]=$(`#list-ctype_${sc}`);this._list[sc].find(`.ctrls`).click(function(e){e.preventDefault();var ti=$(this).attr(`ti`);var ison=$(this).hasClass(`ison`);var sel=that._from_str(that.comp.state.getstate(`t_${sc}`));sel[ti]=!ison;that.comp.state.setstate(`t_${sc}`,that._to_str(sel));});this._allc[sc]=this.comp.container[sc].find(`#t_all_${sc}`);this._allc[sc].click(function(e){e.preventDefault();var ison=$(this).hasClass(`ison`);if(ison){that.comp.state.setstate(`t_${sc}`,that._to_str(that.type_off[sc]));}else{that.comp.state.setstate(`t_${sc}`,that._to_str(that.type_on[sc]));}});},_set_flt:function(sc,rgs){var that=this;if(rgs==null || rgs==undefined || rgs==''){rgs=this._from_str(``)}var all_sel=true;for(var ti in this.type[sc]){var ccell=this._list[sc].find(`a[ti="${ti}"]`);if(ti in rgs && rgs[ti]){ccell.addClass(`ison`);}else{ccell.removeClass(`ison`,ccell);all_sel=false;}}if(all_sel){this._allc[sc].addClass(`ison`);}else{this._allc[sc].removeClass(`ison`);}},_to_str:function(ob){var ar=[];for(var x in ob){if(ob[x]){ar.push(x);}}return ar.join(',');},_from_str:function(st){var ob={};if(st !==null && st !=undefined && st !=''){var ar=st.split(',');for(var i in ar){ob[ar[i]]=true;}}return ob;},stats:function(sc){var that=this;this._sts[sc]={};for(var ti in this.type[sc]){this._sts[sc][ti]=0;}for(var x in this.fltd[sc]){var i=this.fltd[sc][x];var tis=this._data[sc][i][3];for(var ti in tis){this._sts[sc][ti]+=1;}}for(var ti in this._sts[sc]){this.comp.container[sc].find(`span[ti="${ti}"].stats`).html(this._sts[sc][ti]);}this.comp.container[sc].find(`span[ti="_all"].stats`).html(this.fltd[sc].length);},v:function(sc,i){var tis=this._data[sc][i][3];var tstate=this._from_str(this.tstate[sc]);for(var ti in tis){if((ti in tstate)&& tstate[ti]){return true;}}return false;},show:function(sc){return(this.comp.state.getstate(`list`)==sc)&&(sc in this.enabled);},weld:function(sc){if(sc in this.enabled){this.facet.add_facet(sc,this);}},wire:function(sc){if(sc in this.enabled && !this.comp._loaded[sc]){this.comp._loaded[sc]=true;this._listc=this.comp.page.getcomp(`list`);this._data[sc]=this._listc.data[sc];this._relvals[sc]=this._listc.relvals[sc];this.types[sc]=[];this.type[sc]={};this.type_off[sc]={};this.type_on[sc]={};for(var ti in this._relvals[sc].type){var tv=this._relvals[sc].type[ti];this.type_off[sc][ti]=false;this.type_on[sc][ti]=true;this.types[sc].push(ti);this.type[sc][ti]=tv;}this.types[sc].sort();this._html(sc);this._dressup(sc);}},work:function(sc){if(sc in this.enabled){if(this.show(sc)){this.comp.container[sc].show();}else{this.comp.container[sc].hide();}}},work_flt:function(sc){this.tstate[sc]=this.comp.state.getstate(`t_${sc}`);this._set_flt(sc,this._from_str(this.tstate[sc]));},};function EUmap(comp){this.comp=comp;this.name=`eumap`;this.facet=this.comp.page.getcomp(`facet`).delg;this.enabled={contrib:1};this._map={};this._mapc={};this._list={};this.fltd={};this.mstate={};this._data={};this._allc={};this._sts={};this._all_countries={AT:[`Austria`,true,47.7,15.11],BE:[`Belgium`,true,51.3,3.1],HR:[`Croatia`,true,44.7,15.6],CY:[`Cyprus`,true,35.0,32.8],CZ:[`Czech Republic`,true,49.8,15.2],DK:[`Denmark`,true,55.6,11.0],EE:[`Estonia`,true,59.0,25.0],FR:[`France`,true,46.5,1.9],DE:[`Germany`,true,51.0,10.4],GR:[`Greece`,true,38.0,23.8],HU:[`Hungary`,true,46.9,19.8],IE:[`Ireland`,true,53.1,-8.4],IT:[`Italy`,true,41.6,13.0],LV:[`Latvia`,true,56.9,26.8],LT:[`Lithuania`,true,55.2,24.9],LU:[`Luxembourg`,true,49.6,6.1],MT:[`Malta`,true,35.9,14.4],NL:[`Netherlands`,true,52.8,5.8],PL:[`Poland`,true,52.3,19.8],PT:[`Portugal`,true,38.7,-9.0],RS:[`Serbia`,true,44.0,20.8],SK:[`Slovakia`,true,48.8,19.9],SI:[`Slovenia`,true,46.2,14.4],CH:[`Switzerland`,true,46.9,8.3],GB:[`United Kingdom`,true,52.9,-1.8],AL:[`Albania`,false],AD:[`Andorra`,false],BY:[`Belarus`,false],BA:[`Bosnia and Herzegovina`,false],BG:[`Bulgaria`,false],FI:[`Finland`,false],GE:[`Georgia`,false],IS:[`Iceland`,false],SM:[`San Marino`,false],KS:[`Kosovo`,false],LI:[`Liechtenstein`,false],MK:[`Macedonia`,false],MD:[`Moldova`,false],MC:[`Monaco`,false],ME:[`Montenegro`,false],NO:[`Norway`,false],RO:[`Romania`,false],RU:[`Russian Federation`,false],ES:[`Spain`,false],SE:[`Sweden`,false],TR:[`Turkey`,false],UA:[`Ukraine`,false],};this.not_mapped={CY:true,};this.countries=[];this.country={};this.marker={};this.country_off={};this.country_on={};this.setvalues={};for(var cd in this._all_countries){var cprop=this._all_countries[cd];if(cprop[1]){this.country_off[cd]=false;this.country_on[cd]=true;this.countries.push(cd);this.country[cd]=cprop[0];if(cprop.length > 3){this.marker[cd]={latLng:[cprop[2],cprop[3]],name:cprop[0]};}this.setvalues[cd]=`indariah`;}else{this.setvalues[cd]=`outdariah`;}}this.countries.sort();};EUmap.prototype={_html:function(sc){var cols=2;var h=`<div><p class="dctrl">By country</p>`;h +=`<div id="map-europe_${sc}"></div>
<p class="all"><span cd="_all" class="stats"></span> <a id="m_all_${sc}" href="#" class="ctrls">all DARIAH</a></p>
<table class="clist" id="list-europe_${sc}"><tr>`;for(var i in this.countries){if((i % cols==0)&&(i > 0)&&(i < this.countries.length)){h +=`</tr><tr>`;}var cd=this.countries[i];var cn=this.country[cd];h +=`<td><span cd="${cd}" class="stats"></span></td><td><a cd="${cd}" href="#" class="ctrls">${cn}</a></td>`;}h +=`</tr></table></div>`;this.comp.container[sc].html(h);},_dressup:function(sc){var that=this;this._mapc[sc]=$(`#map-europe_${sc}`);this._list[sc]=$(`#list-europe_${sc}`);this._mapc[sc].width(`100%`);this._mapc[sc].height(this._mapc[sc].width()*0.6);this._mapc[sc].vectorMap({map:`europe_mill`,backgroundColor:`#ccccff`,regionsSelectable:true,regionsSelectableOne:false,markerStyle:{initial:{fill:`#448844`,'fill-opacity':1,stroke:`none`,'stroke-width':0,'stroke-opacity':1,'r':1,},hover:{'fill-opacity':0.8,cursor:`pointer`,stroke:`#000000`,'stroke-width':0,'stroke-opacity':1,},selected:{},selectedHover:{},},regionStyle:{initial:{fill:`#bbbbbb`,'fill-opacity':1,stroke:`none`,'stroke-width':0,'stroke-opacity':1,},hover:{'fill-opacity':0.8,cursor:`pointer`,stroke:`#ffff44`,'stroke-width':3,'stroke-opacity':1,},selected:{'fill-opacity':1,fill:`#dd8844`,},selectedHover:{},},markers:this.marker,series:{markers:[{values:{},scale:[0,15],normalizeFunction:`linear`,attribute:`r`,min:0,max:100,}],regions:[{scale:{outdariah:`#ffffff`,indariah:`#ffeedd`,},attribute:`fill`,values:that.setvalues,}],},onRegionTipShow:function(e,el,cd){el.html(`${cd}: ${(cd in that._sts[sc])?that._sts[sc][cd]:'not in DARIAH'}`);},onRegionClick:function(e,c){if(!(c in that.country)){e.preventDefault();}},onRegionSelected:function(e,c,i,sel){if(that.changeState){that.comp.state.setstate(`m_${sc}`,that._a_to_str(sel));}},});this._map[sc]=this._mapc[sc].vectorMap('get','mapObject');this._map[sc].setFocus({regions:this.countries});this._map[sc].setFocus({regions:[`GB`,`GR`]});this._list[sc].find(`.ctrls`).click(function(e){e.preventDefault();var cd=$(this).attr(`cd`);var ison=$(this).hasClass(`ison`);var sel=that._from_str(that.comp.state.getstate(`m_${sc}`));sel[cd]=!ison;that.comp.state.setstate(`m_${sc}`,that._to_str(sel));});this._allc[sc]=this.comp.container[sc].find(`#m_all_${sc}`);this._allc[sc].click(function(e){e.preventDefault();var ison=$(this).hasClass(`ison`);if(ison){that.comp.state.setstate(`m_${sc}`,that._to_str(that.country_off));}else{that.comp.state.setstate(`m_${sc}`,that._to_str(that.country_on));}});},_set_flt:function(sc,rgs){var that=this;if(rgs==null || rgs==undefined || rgs==''){rgs=this._from_str(``)}this.changeState=false;var sv={};for(var cnm in this.not_mapped){if(cnm in rgs){sv[cnm]=rgs[cnm];delete rgs[cnm];}}this._map[sc].setSelectedRegions(rgs);for(var cnm in sv){rgs[cnm]=sv[cnm];}this.changeState=true;var all_sel=true;for(var cd in this.country){var ccell=this._list[sc].find(`a[cd="${cd}"]`);if(cd in rgs && rgs[cd]){ccell.addClass(`ison`);}else{ccell.removeClass(`ison`);all_sel=false;}}if(all_sel){this._allc[sc].addClass(`ison`);}else{this._allc[sc].removeClass(`ison`);}},_a_to_str:function(ar){return ar.join(',');},_to_str:function(ob){var ar=[];for(var x in ob){if(ob[x]){ar.push(x);}}return ar.join(',');},_from_str:function(st){var ob={};if(st !==null && st !=undefined && st !=''){var ar=st.split(',');for(var i in ar){ob[ar[i]]=true;}}for(var cd in this.country){if(!(cd in ob)){ob[cd]=false;}}return ob;},stats:function(sc){var that=this;this._sts[sc]={};for(var cd in this.country){this._sts[sc][cd]=0;}for(var x in this.fltd[sc]){var i=this.fltd[sc][x];var cd=this._data[sc][i][2];this._sts[sc][cd]+=1;}var total=this.fltd[sc].length;if(total==0){total=1}for(var cd in this._sts[sc]){this.comp.container[sc].find(`span[cd="${cd}"].stats`).html(this._sts[sc][cd]);}var wsts={};for(var cd in this._sts[sc]){var pr=100 * this._sts[sc][cd]/ total;wsts[cd]=(total < 10)?pr:(10*Math.sqrt(pr));}this._map[sc].series.markers[0].setValues(wsts);this.comp.container[sc].find(`span[cd="_all"].stats`).html(this.fltd[sc].length);},v:function(sc,i){var cd=this._data[sc][i][2];var mstate=this._from_str(this.mstate[sc]);return(cd in mstate)&& mstate[cd];},show:function(sc){return(this.comp.state.getstate(`list`)==sc)&&(sc in this.enabled);},weld:function(sc){if(sc in this.enabled){this.facet.add_facet(sc,this);this._html(sc);this._dressup(sc);}},wire:function(sc){if(!this.comp._loaded[sc]){this.comp._loaded[sc]=true;this._data[sc]=this.comp.page.getcomp(`list`).data[sc];}},work:function(sc){if(sc in this.enabled){if(this.show(sc)){this.comp.container[sc].show();}else{this.comp.container[sc].hide();}}},work_flt:function(sc){this.mstate[sc]=this.comp.state.getstate(`m_${sc}`);this._set_flt(sc,this._from_str(this.mstate[sc]));},};function Facet(comp){this.comp=comp;this._loaded={};this._facets={};this._stats={};this.data={};this.table={};this.fltd={};};Facet.prototype={_html:function(sc){var h=``;h +=`<p class="facet">Filtering <span id="fstats_${sc}"></span></p>`;this.comp.container[sc].html(h);},_do_all:function(mth,sc){for(var i in this._facets[sc]){var fct=this._facets[sc][i];fct[mth](sc);}},_work_flt:function(sc){this.table[sc].find(`tr[id]`).hide();var data=this.comp.page.getcomp(`list`).data[sc];this.fltd[sc]=[];for(var j in this._facets[sc]){var fct=this._facets[sc][j];fct.fltd[sc]=[];}for(var i in data){var v=true;var the_false=null;var discard=false;for(var j in this._facets[sc]){if(!discard){var fct=this._facets[sc][j];var tv=fct.v(sc,i);if(!tv){v=false;if(the_false==null){the_false=j;}else{discard=true;}}}}if(!discard){if(v){this.fltd[sc].push(i);this.table[sc].find(`tr[id="r${data[i][0]}"]`).show();}if(the_false !=null){var fct=this._facets[sc][the_false];fct.fltd[sc].push(i);}else{for(var j in this._facets[sc]){var fct=this._facets[sc][j];fct.fltd[sc].push(i);}}}}for(var j in this._facets[sc]){var fct=this._facets[sc][j];fct.stats(sc);}this._stats[sc].html(`${this.fltd[sc].length} of ${data.length}`);},add_facet:function(sc,fct){if(this._facets[sc]==undefined){this._facets[sc]=[];}this._facets[sc].push(fct);},show:function(sc){return this.comp.state.getstate(`list`)==sc;},weld:function(sc){this._html(sc);this._loaded[sc]=false;this._facets[sc]=[];this._stats[sc]=$(`#fstats_${sc}`);},wire:function(sc){this.table[sc]=$(`#table_${sc}`);if(!this._loaded[sc]){this.data[sc]=this.comp.page.getcomp(`list`).data[sc];this._do_all(`wire`,sc);this._loaded[sc]=true;var detailcontrols=`<a class="showc fa fa-chevron-right" href="#" title="Show details"></a><a class="hidec fa fa-chevron-down" href="#" title="Hide details"></a>`;$(`p.dctrl`).each(function(){var orig=$(this).html();$(this).html(`${detailcontrols}&nbsp;${orig}`);});$(`p.dctrl`).closest(`div`).find(`table,.flt`).show();$(`.hidec`).show();$(`.showc`).hide();$(`.hidec`).click(function(e){e.preventDefault();var dt=$(this).closest(`p`);var dd=$(this).closest(`div`).find(`table,.flt`);dd.hide();dt.find(`.hidec`).hide();dt.find(`.showc`).show();});$(`.showc`).click(function(e){e.preventDefault();var dt=$(this).closest(`p`);var dd=$(this).closest(`div`).find(`table,.flt`);dd.show();dt.find(`.hidec`).show();dt.find(`.showc`).hide();});}},work:function(sc){if(this.show(sc)){this.comp.container[sc].show();for(var j in this._facets[sc]){var fct=this._facets[sc][j];fct.work_flt(sc);}this._work_flt(sc);}else{this.comp.container[sc].hide();}},};function Filter(comp){this.comp=comp;this.name=`filter`;this.facet=this.comp.page.getcomp(`facet`).delg;this.tags={};this.fltc={};this.boxf={};this.autoc={};this.statsf={};this.clearf={};this._flted={};this._data={};this.fltd={};this.wire_mode={};};Filter.prototype={_html:function(sc){var h=`<div><p class="dctrl">By full text search</p>`;h +=`<div class="flt" id="fltw_${sc}">`;h +=`<p id="fbox_${sc}" class="fbox ui-widget">`;h +=`<input id="flt_${sc}" class="flt"/>`;h +=`<a href="#" class="ctrl fa fa-close filtc" id="clearf_${sc}"></a>`;h +=`<span class="stats" id="stats_${sc}"></span>&nbsp;`;h +=`</p>`;h +=`<div id="autoc_${sc}" style="display: none;">here ${sc}</div>`;h +=`</div>`;this.comp.container[sc].html(h);},_set_flt:function(sc){var textf=this.comp.state.getstate(`f_${sc}`);this.comp.container[sc].addClass(`flt`);this.fltc[sc].val(textf);this.fltc[sc].autocomplete(`search`,textf);},_work_ctl:function(sc){var textf=this.fltc[sc].val();if(textf==``){this.boxf[sc].removeClass(`ison`);this.clearf[sc].hide();}else{this.boxf[sc].addClass(`ison`);this.clearf[sc].show();}},_response:function(sc){var that=this;return function(event,ui){that._flted[sc]={};for(var i in ui.content){that._flted[sc][ui.content[i].value]=1;}if(!(that.wire_mode[sc])){that.comp.state.setstate(`f_${sc}`,that.fltc[sc].val());}};},_setclear:function(sc){var that=this;this.clearf[sc].click(function(e){e.preventDefault();that.fltc[sc].val(``);that.fltc[sc].autocomplete(`search`,``);});},stats:function(sc){var prf=(this.fltc[sc].val()!=``)?`${this.facet.fltd[sc].length} of `:``;this.statsf[sc].html(`${prf}${this.fltd[sc].length}`);},v:function(sc,i){return(i in this._flted[sc]);},show:function(sc){return this.comp.state.getstate(`list`)==sc;},weld:function(sc){this.facet.add_facet(sc,this);this._html(sc);var cc=$(`#fltw_${sc}`);this.comp.container[sc]=cc;this.fltc[sc]=cc.find(`#flt_${sc}`);this.boxf[sc]=cc.find(`#fbox_${sc}`);this.autoc[sc]=cc.find(`#autoc_${sc}`);this.statsf[sc]=cc.find(`#stats_${sc}`);this.clearf[sc]=cc.find(`#clearf_${sc}`);this._flted[sc]={};this.fltd[sc]=[];},wire:function(sc){var that=this;if(!this.facet._loaded[sc]&& !this.comp._loaded[sc]){this.comp._loaded[sc]=true;var data=this.comp.page.getcomp(`list`).data[sc];this._data[sc]=data;this.tags[sc]=[];for(var i in data){this.tags[sc].push({label:data[i][1],value:i});}this._setclear(sc);this.fltc[sc].autocomplete({appendTo:this.autoc[sc],source:this.tags[sc],response:this._response(sc),minLength:0,});this.wire_mode[sc]=true;this._set_flt(sc);this.wire_mode[sc]=false;}},work:function(sc){if(this.show(sc)){this.comp.container[sc].show();}else{this.comp.container[sc].hide();}},work_flt:function(sc){this._work_ctl(sc);},};var escapeHTML=(function(){`use strict`;var chr={'&':`&amp;`,'<':`&lt;`,'>':`&gt;`};return function(text){return text.replace(/[&<>]/g,function(a){return chr[a];});};}());var Request={parameter:function(name){return this.parameters()[name];},parameters:function(uri){var i,parameter,params,query,result;result={};if(!uri){uri=window.location.search;}if(uri.indexOf("?")===-1){return{};}query=uri.slice(1);params=query.split("&");i=0;while(i < params.length){parameter=params[i].split("=");result[parameter[0]]=parameter[1];i++;}return result;}};var rvars=Request.parameters();var nslvars=$.initNamespaceStorage(`req`);var lvars=nslvars.localStorage;function List(comp){this.comp=comp};List.prototype={_html:function(sc){var h=``;h +=`<table id="table_${sc}">`;if(sc==`contrib`){for(var i in this.comp.data[sc]){r=this.comp.data[sc][i];h +=`<tr id="r${r[0]}"><td class="cc">${r[2]}<td><td class="cn">${r[3]}<td><td><a href="#" rid="${r[0]}">${r[1]}</a></td></tr>`;}}else if(sc==`country`){for(var i in this.comp.data[sc]){r=this.comp.data[sc][i];h +=`<tr id="r${r[0]}"><td class="cc">${r[0]}<td><td class="cn">${r[1]}<td></tr>`;}}h +=`</table>`;this.comp.container[sc].html(h);},show:function(sc){return this.comp.state.getstate(`list`)==sc;},weld:function(sc){},wire:function(sc){this._html(sc);},work:function(sc){},};$(function(){(new Page()).work(`page`)});function Msg(dst,on_clear){var that=this;this._dst=$(`#${dst}`);this._trashc=$(`#trash_${dst}`);this._trashp=this._trashc.closest(`p`);this._trashc.click(function(e){e.preventDefault();that.clear();});this._hide();this._on_clear=on_clear;};Msg.prototype={_hide:function(){this._dst.hide();this._trashp.hide();},_show:function(){this._dst.show();if(this._dst.html()!=``){this._trashp.show();}},clear:function(){this._dst.html(``);if(this._on_clear !=undefined){this._on_clear();}this._hide();},msg:function(text,kind){if(kind==undefined){kind=`info`;}var mtext=this._dst.html();this._dst.html(`${mtext}<p class="${kind}">${text}</p>`);this._show();},};function Page(){this.name=`page`;this.msg=new Msg(`msg_${this.name}`);this.state=new ViewState(this);var main_lists=this.state.getvalues(`list`);this._components=[[`left`,`control`,main_lists,false,Control],[`control`,`facet`,main_lists,false,Facet],[`facet`,`filter`,main_lists,false,Filter],[`facet`,`eumap`,main_lists,false,EUmap],[`facet`,`ctype`,main_lists,false,CType],[`middle`,`list`,main_lists,true,List],];this.compindex={};this._routing={page:[`control`],control:[`list`],list:[`facet`],facet:[`filter`,`eumap`,`ctype`,],};this.weld();};Page.prototype={_set_height(subtract){var wh=`${window.innerHeight - subtract}px`;for(var w in{middle:1,left:1,right:1}){$(`#${w}`).css(`height`,wh);}},getcomp:function(name){return this.compindex[name];},weld:function(){this.compindex={};for(var i in this._components){var c=this._components[i];var co=new Component(c[0],c[1],c[2],c[3],c[4],this);this.compindex[c[1]]=co;co.weld();}this._set_height(80);History.Adapter.bind(window,`statechange`,this.state.work());},work:function(comp,sc){if(this._routing[comp]!=undefined){for(var i in this._routing[comp]){var oname=this._routing[comp][i];this.compindex[oname].work(sc);}}},};function ViewState(page){this._data={};this.weld();this.page=page;this.msg=page.msg;};ViewState.prototype={_specs:{list:{type:`string`,values:{contrib:1,country:1},def:`contrib`},f_contrib:{type:`string`,values:null,def:``},f_country:{type:`string`,values:null,def:``},m_contrib:{type:`string`,values:null,def:``},m_country:{type:`string`,values:null,def:``},t_contrib:{type:`string`,values:null,def:``},t_country:{type:`string`,values:null,def:``},id:{type:`integer`,values:{min:-1,max:1000000},def:0},sort:{type:`boolean`,values:{v:true,x:false},def:true},},_showas:{list:{contrib:{sg:`contribution`,pl:`contributions`},country:{sg:`country`,pl:`countries`},},},_validate:function(name,val){var newval,message;if(name in this._specs){var s=this._specs[name];if(s.type==`string`){if(s.values){if(val in s.values){newval=val;}else{newval=s.def;this.msg.msg(`illegal string value for ${name}: "${val}" is replaced by "${s.def}"`,`warning`);}}else{newval=val;}}else if(s.type==`integer`){if(/^(\-|\+)?[0-9]+$/.test(val)){newval=Number(val);}else{newval=s.def;this.msg.msg(`not a number value for ${name}: "${val}" is replaced by "${s.def}"`,`warning`);}}else if(s.type==`boolean`){if(val in s.values){newval=s.values[val];}else{newval=s.def;this.msg.msg(`illegal boolean value for ${name}: "${val}" is replaced by "${s.def}"`,`warning`);}}}else{newval=null;this.msg.msg(`unknown parameter: ${name}=${val}`,`warning`);}return newval;},_getvars:function(){vars=[];for(var name in this._data){var val=this._data[name];var spec=this._specs[name];if(spec.type==`string` || spec.type==`integer`){vars.push(`${name}=${val}`)}else if(spec.type==`boolean`){for(z in spec.values){if(spec.values[z]==val){vars.push(`${name}=${z}`)}}}}return vars.join(`&`)},_getinitstate:function(){for(var name in rvars){if(!(name in this._specs)){this.msg.msg(`unknown parameter: ${name}=${val}`,`warning`);}}for(var name in this._specs){var val=null;if(name in rvars){var raw_val=rvars[name];val=this._validate(name,raw_val);lvars.set(name,val);}else if(lvars.isSet(name)){val=lvars.get(name);}else{val=this._specs[name].def;lvars.set(name,val);}this._data[name]=val;}},_addHist:function(title,view_url){var tit=`DARIAH contribution tool`;var this_url=`${app_url}?${this._getvars()}`;History.pushState(this._data,tit,this_url);},setstate:function(name,val){this._data[name]=val;lvars.set(name,val);this._addHist();},getstate:function(name){return this._data[name];},getvalues:function(name){return this._specs[name].values;},showstate:function(name,val,mode){var result=val;var md=(mode==undefined)?`sg`:mode;if(this._showas[name]!=undefined && this._showas[name][val]!=undefined){result=this._showas[name][val][mode];}return result;},weld:function(){this._getinitstate();this._addHist();},work:function(){var that=this;return function(){var state=History.getState();if(state && state.data){that._data=state.data;that.page.work(`page`);}}},};