'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally {try{if(!_n&&_i['return'])_i['return']()}finally {if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else {throw new TypeError('Invalid attempt to destructure non-iterable instance')}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value' in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _generic=require('./generic.js');var g=_interopRequireWildcard(_generic);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else {var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var _stats=Symbol();var _enabled_facets=Symbol();var _class=function(){function _class(component){_classCallCheck(this,_class);this.component=component;this[_stats]=new Map;this[_enabled_facets]=new Map;this.table=new Map;this.distilled=new Map}_createClass(_class,[{key:'_html',value:function _html(vr){var h='<p><span fct="all"></span>Filtering <span id="fstats_'+vr+'"></span></p>';this.component.container.get(vr).html(h)}},{key:'show',value:function show(vr){return this.component.state.getState('list')==vr}},{key:'weld',value:function weld(vr){var children=this.component.children;this[_enabled_facets].set(vr,new Map);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step$value=_slicedToArray(_step.value,2);var facet_name=_step$value[0];var facet_component=_step$value[1];if(facet_component.hasVariant(vr)){this[_enabled_facets].get(vr).set(facet_name,facet_component)}}}catch(err){_didIteratorError=true;_iteratorError=err}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally {if(_didIteratorError){throw _iteratorError}}}this._html(vr)}},{key:'_display',value:function _display(expand_control,mode){var that=this;var dt=expand_control.closest('p');var hidec=dt.find('.hidec');var morec=dt.find('.morec');var showc=dt.find('.showc');var expanded_material=expand_control.closest('div').find('table,.flt');var condensed_material=expand_control.closest('div').find('.value_list2,.flt_compact');var not_expanded_material=expand_control.closest('div').find('.flt_not_expanded');var key='fctx_'+expand_control.closest('span').attr('fct');var mode_undef=mode==undefined;if(mode_undef){if(g.localstorage_vars.isSet(key)){mode=g.localstorage_vars.get(key)}else {mode=1}}var all_facets=key=='fctx_all';if(all_facets&&!mode_undef){expand_control.closest('div').find('div.component span[fct]').each(function(){that._display($(this),mode)})}g.localstorage_vars.set(key,mode);if(mode==0){hidec.show();morec.hide();showc.hide();if(!all_facets){not_expanded_material.show();expanded_material.hide();condensed_material.hide()}}else if(mode==1){hidec.hide();morec.show();showc.hide();if(!all_facets){not_expanded_material.show();expanded_material.hide();condensed_material.show()}}else {hidec.hide();morec.hide();showc.show();if(!all_facets){not_expanded_material.hide();expanded_material.show();condensed_material.hide()}}}},{key:'wire',value:function wire(vr){var that=this;var cc=this.component.container.get(vr);var lc=this.component.page.getComponent('list').container.get(vr);this[_stats].set(vr,cc.find('#fstats_'+vr));this.table.set(vr,lc.find('#table_'+vr));var info=' details; click to change level of details';var detailcontrols='<a class="showc fa fa-fw fa-list-ul" href="#" title="full'+info+'"></a><a class="morec fa fa-fw fa-align-left" href="#" title="condensed'+info+'"></a><a class="hidec fa fa-fw fa-minus" href="#" title="hidden'+info+'"></a>';cc.addClass('facet');cc.find('span[fct]').each(function(){$(this).html(detailcontrols+'&nbsp');that._display($(this))});cc.find('.hidec').click(function(e){e.preventDefault();that._display($(this),1)});cc.find('.morec').click(function(e){e.preventDefault();that._display($(this),2)});cc.find('.showc').click(function(e){e.preventDefault();that._display($(this),0)})}},{key:'work',value:function work(vr){this.table.get(vr).find('tr[rid],tr[iid]').hide();var mother_list=this.component.page.getComponent('list');var data=mother_list.data.get(vr);var facets=this[_enabled_facets].get(vr);this.distilled.set(vr,[]);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=facets[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _step2$value=_slicedToArray(_step2.value,2);var facet_name=_step2$value[0];var facet_comp=_step2$value[1];var facet=facet_comp.implementation;facet.distilled.set(vr,[])}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally {if(_didIteratorError2){throw _iteratorError2}}}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var d=_step3.value;var v=true;var the_false=null;var discard=false;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=facets[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _step5$value=_slicedToArray(_step5.value,2);var facet_name=_step5$value[0];var facet_comp=_step5$value[1];if(!discard){var _facet2=facet_comp.implementation;var this_v=_facet2.v(vr,d[0]);if(!this_v){v=false;if(the_false==null){the_false=_facet2}else {discard=true}}}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally {try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally {if(_didIteratorError5){throw _iteratorError5}}}if(!discard){if(v){this.distilled.get(vr).push(d[0]);this.table.get(vr).find('tr[rid="'+d[0]+'"],tr[iid="'+d[0]+'"]').show()}if(the_false!=null){the_false.distilled.get(vr).push(d[0])}else {var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=facets[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var _step6$value=_slicedToArray(_step6.value,2);var facet_name=_step6$value[0];var facet_comp=_step6$value[1];var _facet=facet_comp.implementation;_facet.distilled.get(vr).push(d[0])}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally {try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally {if(_didIteratorError6){throw _iteratorError6}}}}}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally {if(_didIteratorError3){throw _iteratorError3}}}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=facets[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _step4$value=_slicedToArray(_step4.value,2);var facet_name=_step4$value[0];var facet_comp=_step4$value[1];var _facet3=facet_comp.implementation;_facet3.stats(vr)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally {try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally {if(_didIteratorError4){throw _iteratorError4}}}this[_stats].get(vr).html(this.distilled.get(vr).length+' of '+data.length)}}]);return _class}();exports.default=_class;