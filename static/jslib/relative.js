'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally {try{if(!_n&&_i['return'])_i['return']()}finally {if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else {throw new TypeError('Invalid attempt to destructure non-iterable instance')}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value' in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _generic=require('./generic.js');var g=_interopRequireWildcard(_generic);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else {var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var _list=Symbol();var _list2=Symbol();var _all_values_control=Symbol();var _cols=Symbol();var _cutoff=Symbol();var _shortsize=Symbol();var _class=function(){function _class(component,rtype,cols,cutoff,shortsize){_classCallCheck(this,_class);this.component=component;this.distilled=new Map;this[_list]=new Map;this[_list2]=new Map;this.related_state=new Map;this[_all_values_control]=new Map;this.statistics=new Map;this.related_values_list=new Map;this.related_values_index=new Map;this.related_values_all=new Map;this.no_values={value:'-',name:'-none'};this.typ=rtype;this[_cols]=cols||2;this[_cutoff]=cutoff||14;this[_shortsize]=shortsize||6}_createClass(_class,[{key:'_html',value:function _html(vr){var type_sg=this.component.state.showState('list',this.typ,'sg');var type_pl=this.component.state.showState('list',this.typ,'pl');var h='';h+=this._preHtml(vr);h+='\n<div>\n    <p class="dctrl"><span fct="'+this.component.name+'-'+vr+'"></span> By '+type_sg+'</p>\n    <p class="all"><span rv="_all" class="stats"></span> <a rv="_all" href="#" class="facet_single_all">all '+type_pl+'</a></p>\n    <table class="value_list" id="list-'+this.typ+'-vals_'+vr+'">\n        <tr>\n';var ar=this.related_values_list.get(vr);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=ar.entries()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step$value=_slicedToArray(_step.value,2);var i=_step$value[0];var related_value=_step$value[1];if(i%this[_cols]==0&&i>0&&i<ar.length){h+='</tr><tr>'}var raw_value=this.related_values_index.get(vr).get(related_value);h+='\n            <td><span rv="'+related_value+'" class="stats"></span></td>\n            <td><a rv="'+related_value+'" href="#" class="facet_single">'+g.escapeHTML(raw_value)+'</a></td>\n            '}}catch(err){_didIteratorError=true;_iteratorError=err}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally {if(_didIteratorError){throw _iteratorError}}}h+='\n        </tr>\n    </table>\n    <p class="value_list2" id="list2-'+this.typ+'-vals_'+vr+'">\n';var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=ar.entries()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _step2$value=_slicedToArray(_step2.value,2);var i=_step2$value[0];var related_value=_step2$value[1];var _raw_value=this.related_values_index.get(vr).get(related_value);var compact_value=g.escapeHTML(g.compact(this[_cutoff],this[_shortsize],_raw_value));h+='<a href="#" rv="'+related_value+'" class="passive_small" title="'+g.escapeHTML(_raw_value)+'">'+compact_value+'</a> '}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally {if(_didIteratorError2){throw _iteratorError2}}}h+='\n    </p>\n</div>';this.component.container.get(vr).html(h)}},{key:'_dressup',value:function _dressup(vr){var cc=this.component.container.get(vr);this[_list].set(vr,cc.find('#list-'+this.typ+'-vals_'+vr));this[_list2].set(vr,cc.find('#list2-'+this.typ+'-vals_'+vr));var that=this;this[_list].get(vr).find('.facet_single').click(function(e){e.preventDefault();var related_value=$(this).attr('rv');var selected=g.from_str(that.component.state.getState('rel_'+that.typ+'_'+vr));if(selected.has(related_value)){selected.delete(related_value)}else {selected.add(related_value)}that.component.state.setState('rel_'+that.typ+'_'+vr,g.to_str(selected));cc.find('.last_handled').removeClass('last_handled');$(this).addClass('last_handled')});this[_list2].get(vr).find('.passive_small').click(function(e){e.preventDefault();var related_value=$(this).attr('rv');var selected=g.from_str(that.component.state.getState('rel_'+that.typ+'_'+vr));if(selected.has(related_value)){selected.delete(related_value)}else {selected.add(related_value)}that.component.state.setState('rel_'+that.typ+'_'+vr,g.to_str(selected));$(this).closest('div').find('.morec').click();var last_handled=that[_list].get(vr).find('a[rv="'+related_value+'"]');cc.find('.last_handled').removeClass('last_handled');last_handled.addClass('last_handled');$('#left')[0].scrollTop=50;last_handled[0].scrollIntoView({behavior:'smooth',alignToTop:'true'})});this[_all_values_control].set(vr,this.component.container.get(vr).find('[rv="_all"]'));this[_all_values_control].get(vr).click(function(e){e.preventDefault();var ison=$(this).hasClass('ison');if(ison){that.component.state.setState('rel_'+that.typ+'_'+vr,'')}else {that.component.state.setState('rel_'+that.typ+'_'+vr,g.to_str(that.related_values_all.get(vr)))}})}},{key:'_setFacet',value:function _setFacet(vr){var all_selected=true;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.related_values_index.get(vr).keys()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var related_value=_step3.value;var facet_cell=this[_list].get(vr).find('[rv="'+related_value+'"]');var facet_cell2=this[_list2].get(vr).find('[rv="'+related_value+'"]');if(this.related_state.get(vr).has(related_value+'')){facet_cell.addClass('ison');facet_cell2.addClass('ison')}else {facet_cell.removeClass('ison');facet_cell2.removeClass('ison');all_selected=false}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally {if(_didIteratorError3){throw _iteratorError3}}}if(all_selected){this[_all_values_control].get(vr).addClass('ison')}else {this[_all_values_control].get(vr).removeClass('ison')}}},{key:'stats',value:function stats(vr){this.statistics.set(vr,new Map);var rvs=this.statistics.get(vr);var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.related_values_index.get(vr).keys()[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var related_value=_step4.value;rvs.set(related_value,0)}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally {try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally {if(_didIteratorError4){throw _iteratorError4}}}var related_info=this.component.related_info.get(vr);var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=this.distilled.get(vr)[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var i=_step5.value;var has_related_value=false;if(related_info.has(i)){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=related_info.get(i)[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var _related_value=_step7.value;rvs.set(_related_value,rvs.get(_related_value)+1);has_related_value=true}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally {try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return()}}finally {if(_didIteratorError7){throw _iteratorError7}}}}if(!has_related_value){var nv=this.no_values.value;rvs.set(nv,rvs.get(nv)+1)}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally {try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally {if(_didIteratorError5){throw _iteratorError5}}}var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=rvs[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var _step6$value=_slicedToArray(_step6.value,2);var _related_value2=_step6$value[0];var stat=_step6$value[1];this.component.container.get(vr).find('span[rv="'+_related_value2+'"].stats').html(stat)}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally {try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally {if(_didIteratorError6){throw _iteratorError6}}}this.component.container.get(vr).find('span[rv="_all"].stats').html(this.distilled.get(vr).length);this._myStats(vr)}},{key:'v',value:function v(vr,i){var related_info=this.component.related_info.get(vr);var related_state=this.related_state.get(vr);if(related_info.has(i)){var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=related_info.get(i)[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var related_value=_step8.value;if(related_state.has(related_value+'')){return true}}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally {try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return()}}finally {if(_didIteratorError8){throw _iteratorError8}}}}else {if(related_state.has(this.no_values.value)){return true}}return false}},{key:'show',value:function show(vr){return this.component.state.getState('list')==vr}},{key:'weld',value:function weld(vr){this.related_values_list.set(vr,[]);this.related_values_index.set(vr,new Map);this.related_values_all.set(vr,new Set);this._plainWeld(vr);this._myWeld(vr);this.related_values_list.get(vr).push(this.no_values.value);this.related_values_index.get(vr).set(this.no_values.value,this.no_values.name);this.related_values_all.get(vr).add(this.no_values.value);this._html(vr)}},{key:'wire',value:function wire(vr){this._myDressup(vr);this._dressup(vr)}},{key:'work',value:function work(vr){this.related_state.set(vr,g.from_str(this.component.state.getState('rel_'+this.typ+'_'+vr)));this._mySetFacet(vr);this._setFacet(vr)}},{key:'_plainWeld',value:function _plainWeld(vr){var related_values=this.component.related_values.get(vr);var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=related_values[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var _step9$value=_slicedToArray(_step9.value,2);var i=_step9$value[0];var related_value=_step9$value[1];this.related_values_list.get(vr).push(i);this.related_values_index.get(vr).set(i,related_value);this.related_values_all.get(vr).add(i)}}catch(err){_didIteratorError9=true;_iteratorError9=err}finally {try{if(!_iteratorNormalCompletion9&&_iterator9.return){_iterator9.return()}}finally {if(_didIteratorError9){throw _iteratorError9}}}this.related_values_list.get(vr).sort(function(a,b){return related_values.get(a)<related_values.get(b)?-1:related_values.get(a)>related_values.get(b)?1:0})}},{key:'_myWeld',value:function _myWeld(vr){}},{key:'_preHtml',value:function _preHtml(vr){return ''}},{key:'_myDressup',value:function _myDressup(vr){}},{key:'_mySetFacet',value:function _mySetFacet(vr){}},{key:'_myStats',value:function _myStats(vr){}}]);return _class}();exports.default=_class;