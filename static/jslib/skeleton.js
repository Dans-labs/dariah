'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally {try{if(!_n&&_i['return'])_i['return']()}finally {if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else {throw new TypeError('Invalid attempt to destructure non-iterable instance')}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value' in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}var _class=function(){function _class(){_classCallCheck(this,_class);this.stages=new Map([['weld',true],['wire',true],['work',false]]);this.stages_prev=new Map([['wire','weld'],['work','wire']]);this.before=new Map([['weld',new Map([['item',new Set(['list'])],['facet',new Set(['control','list'])],['filter',new Set(['facet'])],['eumap',new Set(['facet','filter'])],['ctype',new Set(['facet','eumap'])],['tadiraha',new Set(['facet','ctype'])],['tadiraho',new Set(['facet','tadiraha'])],['tadiraht',new Set(['facet','tadiraho'])],['share',new Set(['facet','list'])]])],['wire',new Map([['item',new Set(['list'])],['facet',new Set(['filter','eumap','ctype','tadiraha','tadiraho','tadiraht'])],['filter',new Set(['list'])],['eumap',new Set(['list'])],['ctype',new Set(['list'])],['tadiraha',new Set(['list'])],['tadiraho',new Set(['list'])],['tadiraht',new Set(['list'])]])],['work',new Map([['facet',new Set(['filter','eumap','ctype','tadiraha','tadiraho','tadiraht'])]])]])}_createClass(_class,[{key:'resolveTiming',value:function resolveTiming(){var timing_nodes=[];var timing_edges=new Map;var timing_edges_inv=new Map;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.components.keys()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var name=_step.value;var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=this.stages.keys()[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var stage=_step12.value;timing_nodes.push(name+'-'+stage)}}catch(err){_didIteratorError12=true;_iteratorError12=err}finally {try{if(!_iteratorNormalCompletion12&&_iterator12.return){_iterator12.return()}}finally {if(_didIteratorError12){throw _iteratorError12}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally {if(_didIteratorError){throw _iteratorError}}}function addEdge(prev_node,next_node){if(!timing_edges.has(prev_node)){timing_edges.set(prev_node,new Set)}if(!timing_edges_inv.has(next_node)){timing_edges_inv.set(next_node,new Set)}timing_edges.get(prev_node).add(next_node);timing_edges_inv.get(next_node).add(prev_node)}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.stages_prev[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _step2$value=_slicedToArray(_step2.value,2);var next_stage=_step2$value[0];var prev_stage=_step2$value[1];var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=this.components.keys()[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=true){var _name=_step13.value;addEdge(_name+'-'+prev_stage,_name+'-'+next_stage)}}catch(err){_didIteratorError13=true;_iteratorError13=err}finally {try{if(!_iteratorNormalCompletion13&&_iterator13.return){_iterator13.return()}}finally {if(_didIteratorError13){throw _iteratorError13}}}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally {if(_didIteratorError2){throw _iteratorError2}}}var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.before[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _step3$value=_slicedToArray(_step3.value,2);var _stage=_step3$value[0];var nexts=_step3$value[1];var _iteratorNormalCompletion14=true;var _didIteratorError14=false;var _iteratorError14=undefined;try{for(var _iterator14=nexts[Symbol.iterator](),_step14;!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=true){var _step14$value=_slicedToArray(_step14.value,2);var next_name=_step14$value[0];var prevs=_step14$value[1];if(this.ignore.has(next_name)){continue}var _iteratorNormalCompletion15=true;var _didIteratorError15=false;var _iteratorError15=undefined;try{for(var _iterator15=prevs.keys()[Symbol.iterator](),_step15;!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=true){var prev_name=_step15.value;if(this.ignore.has(prev_name)){continue}addEdge(prev_name+'-'+_stage,next_name+'-'+_stage)}}catch(err){_didIteratorError15=true;_iteratorError15=err}finally {try{if(!_iteratorNormalCompletion15&&_iterator15.return){_iterator15.return()}}finally {if(_didIteratorError15){throw _iteratorError15}}}}}catch(err){_didIteratorError14=true;_iteratorError14=err}finally {try{if(!_iteratorNormalCompletion14&&_iterator14.return){_iterator14.return()}}finally {if(_didIteratorError14){throw _iteratorError14}}}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally {if(_didIteratorError3){throw _iteratorError3}}}var n=0;var subset=[];var visited=new Set;while(n<=timing_nodes.length){subset.push(new Set);if(n==0){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=timing_nodes[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var node=_step4.value;if(!timing_edges_inv.has(node)){subset[n].add(node)}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally {try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally {if(_didIteratorError4){throw _iteratorError4}}}}else {var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=visited[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var prev_node=_step5.value;if(timing_edges.has(prev_node)){var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=timing_edges.get(prev_node)[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var next_node=_step6.value;if(!visited.has(next_node)){var good=true;var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=timing_edges_inv.get(next_node)[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var other_prev_node=_step7.value;if(!visited.has(other_prev_node)){good=false;break}}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally {try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return()}}finally {if(_didIteratorError7){throw _iteratorError7}}}if(good){subset[n].add(next_node)}}}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally {try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return()}}finally {if(_didIteratorError6){throw _iteratorError6}}}}}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally {try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return()}}finally {if(_didIteratorError5){throw _iteratorError5}}}}if(subset[n].size==0){break}var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=subset[n][Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var _node=_step8.value;visited.add(_node)}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally {try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return()}}finally {if(_didIteratorError8){throw _iteratorError8}}}n++}this._tasks=[];this._timing=new Map;if(visited.size!=timing_nodes.length){var cycle=[];var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=timing_nodes[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var _node2=_step9.value;if(!visited.has(_node2)){cycle.push(_node2)}}}catch(err){_didIteratorError9=true;_iteratorError9=err}finally {try{if(!_iteratorNormalCompletion9&&_iterator9.return){_iterator9.return()}}finally {if(_didIteratorError9){throw _iteratorError9}}}console.log('Circular timing constraints detected',cycle)}else {var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=subset[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var nodes=_step10.value;var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=nodes[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var _node3=_step11.value;this._tasks.push(_node3)}}catch(err){_didIteratorError11=true;_iteratorError11=err}finally {try{if(!_iteratorNormalCompletion11&&_iterator11.return){_iterator11.return()}}finally {if(_didIteratorError11){throw _iteratorError11}}}}}catch(err){_didIteratorError10=true;_iteratorError10=err}finally {try{if(!_iteratorNormalCompletion10&&_iterator10.return){_iterator10.return()}}finally {if(_didIteratorError10){throw _iteratorError10}}}this._timing=timing_edges_inv;console.log('Timing resolved',this._tasks)}}}]);return _class}();exports.default=_class;