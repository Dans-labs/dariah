'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally {try{if(!_n&&_i['return'])_i['return']()}finally {if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else {throw new TypeError('Invalid attempt to destructure non-iterable instance')}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value' in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _generic=require('./generic.js');var g=_interopRequireWildcard(_generic);var _relative=require('./relative');var _relative2=_interopRequireDefault(_relative);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else {var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _map_object=Symbol();var _map_container=Symbol();var _marker=Symbol();var _setvalues=Symbol();var _not_mapped=Symbol();var _class=function(_Relative){_inherits(_class,_Relative);function _class(component){_classCallCheck(this,_class);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(_class).call(this,component,'country'));_this[_map_object]=new Map;_this[_map_container]=new Map;_this[_marker]=new Map;_this[_setvalues]=new Map;_this[_not_mapped]=new Set(['-','CY','KS','TR','MC','GE']);return _this}_createClass(_class,[{key:'_preHtml',value:function _preHtml(vr){return '<div id="map-europe_'+vr+'" class="position">\n    <p class="zoom"><a class="fa fa-arrows" href="#" title="zoom to fit all countries"/></p>\n</div>'}},{key:'_myDressup',value:function _myDressup(vr){var _this2=this;var that=this;var cc=this.component.container.get(vr);this[_map_container].set(vr,cc.find('#map-europe_'+vr));var mapc=this[_map_container].get(vr);var height=mapc.width()*0.6;mapc.width('100%');mapc.height(height);mapc.vectorMap({'map':'europe_mill',backgroundColor:'#ccccff',regionsSelectable:true,markersSelectable:true,regionsSelectableOne:false,markersSelectableOne:false,markerStyle:{initial:{fill:'#008800','fill-opacity':0.2,stroke:'none','stroke-width':0,'stroke-opacity':0.2,'r':1},hover:{cursor:'pointer',stroke:'#ffff44','stroke-width':1,'stroke-opacity':1},selected:{fill:'#008800','fill-opacity':1},selectedHover:{}},regionStyle:{initial:{fill:'#bbbbbb','fill-opacity':1,stroke:'none','stroke-width':0,'stroke-opacity':1},hover:{cursor:'pointer',stroke:'#ffff44','stroke-width':3,'stroke-opacity':1},selected:{fill:'#dd8844','fill-opacity':1},selectedHover:{}},markers:this[_marker].get(vr),series:{markers:[{values:{},scale:[0,20],normalizeFunction:'linear',attribute:'r',min:0,max:100}],regions:[{scale:{'outdariah':'#ffffff','indariah':'#ffddbb'},attribute:'fill',values:this[_setvalues].get(vr)}]},onRegionTipShow:function(e,el,related_value){var rvs=this.statistics.get(vr);el.html(related_value+': '+(rvs.has(related_value)?rvs.get(related_value):'not in DARIAH'))}.bind(this),onMarkerTipShow:function(e,el,related_value){var rvs=this.statistics.get(vr);el.html(related_value+': '+(rvs.has(related_value)?rvs.get(related_value):'not in DARIAH'))}.bind(this),onRegionClick:function(e,related_value){if(!this.related_values_index.get(vr).has(related_value)){e.preventDefault()}}.bind(this),onMarkerClick:function(e,related_value){if(!this.related_values_index.get(vr).has(related_value)){e.preventDefault()}}.bind(this),onRegionSelected:function(e,related_value,i,selected){if(this.change_state){this.component.state.setState('rel_'+this.typ+'_'+vr,g.a_to_str(selected)+this._unmapped_selected(vr))}}.bind(this),onMarkerSelected:function(e,related_value,i,selected){if(this.change_state){this.component.state.setState('rel_'+this.typ+'_'+vr,g.a_to_str(selected)+this._unmapped_selected(vr))}}.bind(this)});var zoom_p=cc.find('p.zoom');zoom_p.css('top',height-20+'px');zoom_p.css('left','10px');var zoom_control=cc.find('p.zoom a');zoom_control.click(function(e){e.preventDefault();_this2[_map_object].get(vr).setFocus({regions:['GB','GR']})});this[_map_object].set(vr,mapc.vectorMap('get','mapObject'));this[_map_object].get(vr).setFocus({regions:['GB','GR']})}},{key:'_unmapped_selected',value:function _unmapped_selected(vr){var result=[];var this_state=g.from_str(vr,this.component.state.getState('rel_'+this.typ+'_'+vr));var empty=true;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this[_not_mapped][Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var related_value=_step.value;if(this_state.has(related_value)){result.push(related_value);empty=false}}}catch(err){_didIteratorError=true;_iteratorError=err}finally {try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally {if(_didIteratorError){throw _iteratorError}}}return empty?'':','+result.join(',')}},{key:'_mySetFacet',value:function _mySetFacet(vr){this.change_state=false;var map_regions={};var map_markers={};var related_values=this.related_state.get(vr);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.component.related_values.get(vr)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _step2$value=_slicedToArray(_step2.value,2);var i=_step2$value[0];var related_value=_step2$value[1];if(!this[_not_mapped].has(i)&&i!=this.no_values.value){map_regions[i]=related_values.has(i);if(related_value[1]){map_markers[i]=related_values.has(i)}}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally {try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally {if(_didIteratorError2){throw _iteratorError2}}}var mapo=this[_map_object].get(vr);mapo.setSelectedRegions(map_regions);mapo.setSelectedMarkers(map_markers);this.change_state=true}},{key:'_myStats',value:function _myStats(vr){var total=this.distilled.get(vr).length;if(total==0){total=1}var weighted_statistics={};var rvs=this.statistics.get(vr);var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=rvs[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _step3$value=_slicedToArray(_step3.value,2);var related_value=_step3$value[0];var stat=_step3$value[1];if(related_value!=this.no_values.value){var pr=100*stat/total;weighted_statistics[related_value]=total<10?pr:10*Math.sqrt(pr)}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally {try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally {if(_didIteratorError3){throw _iteratorError3}}}this[_map_object].get(vr).series.markers[0].setValues(weighted_statistics)}},{key:'_plainWeld',value:function _plainWeld(vr){}},{key:'_myWeld',value:function _myWeld(vr){this[_marker].set(vr,{});this[_setvalues].set(vr,{});var related_values=this.component.related_values.get(vr);var marker=this[_marker].get(vr);var setv=this[_setvalues].get(vr);var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=related_values[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _step4$value=_slicedToArray(_step4.value,2);var i=_step4$value[0];var related_value=_step4$value[1];if(related_value[1]){this.related_values_all.get(vr).add(i);this.related_values_list.get(vr).push(i);this.related_values_index.get(vr).set(i,related_value[0]);marker[i]={latLng:[related_value[2],related_value[3]],name:related_value[0]};setv[i]='indariah'}else {setv[i]='outdariah'}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally {try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally {if(_didIteratorError4){throw _iteratorError4}}}this.related_values_list.get(vr).sort(function(a,b){return related_values.get(a)<related_values.get(b)?-1:related_values.get(a)[0]>related_values.get(b)[0]?1:0})}}]);return _class}(_relative2.default);exports.default=_class;